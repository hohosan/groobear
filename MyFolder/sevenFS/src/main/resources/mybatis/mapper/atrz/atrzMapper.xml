<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.sevenfs.mapper.atrz.AtrzMapper">
	<!--home Ï†ÑÏûêÍ≤∞Ïû¨ -->
	<!-- Í≤∞Ïû¨ ÎåÄÍ∏∞Ï§ëÏù∏ Î¨∏ÏÑúÎ¶¨Ïä§Ìä∏ (Í≤∞Ïû¨ÎåÄÍ∏∞Î¨∏ÏÑú)-->
	<select id="homeAtrzApprovalList" resultMap="atrzMap">
		WITH my_turn_lines AS (
		    SELECT L.*
		    FROM atrz_line L
		    WHERE L.sanctner_empno = #{emplNo}
		      AND L.sanctn_progrs_sttus_code = '00'
		      AND L.atrz_ty = '1'
		      AND NOT EXISTS (
		          SELECT 1
		          FROM atrz_line L2
		          WHERE L2.atrz_doc_no = L.atrz_doc_no
		            AND L2.atrz_ln_sn &lt; L.atrz_ln_sn
		            AND L2.atrz_ty = '1'
		            AND L2.sanctn_progrs_sttus_code NOT IN ('10', '60')
		      )
		)
		SELECT  
		      A.atrz_doc_no
		      , A.drafter_empno
		      , A.drafter_clsf
		      , A.drafter_empnm
		      , A.drafter_dept
		      , A.bkmk_yn
		      , A.atch_file_no
		      , A.atrz_sj
		      , A.atrz_cn
		      , A.atrz_opinion
		      , A.atrz_tmpr_stre_dt
		      , A.atrz_drft_dt
		      , A.atrz_compt_dt
		      , A.atrz_rtrvl_dt
		      , A.atrz_sttus_code
		      , A.eltsgn_image
		      , A.doc_form_no
		      , A.atrz_delete_yn
		      , A.schdul_reg_yn
		      , L.atrz_ln_sn
		      , L.sanctner_empno
		      , L.sanctn_progrs_sttus_code
		      , L.atrz_ty
		      , L.dcrb_author_yn
		      , (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = DRAFTER_DEPT) as DEPT_CODE_NM
		      , (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = DRAFTER_CLSF) as CLSF_CODE_NM
		FROM ATRZ A
		JOIN my_turn_lines L
		  ON A.atrz_doc_no = L.atrz_doc_no
		WHERE A.atrz_compt_dt IS NULL
		  AND A.atrz_sttus_code = '00'
		  AND A.atrz_sttus_code != '99'
		ORDER BY A.atrz_drft_dt DESC
		FETCH FIRST 10 ROWS ONLY
	</select>
	
	<!-- Í∏∞ÏïàÏßÑÌñâÎ¨∏ÏÑú ÏµúÏã†Ïàú5Í∞ú -->
	<select id="atrzMinSubmitList" resultMap="atrzMap" parameterType="string">
		SELECT 					/* AtrzMapper.atrzMinSubmitList */
		       A.atrz_doc_no
		      ,A.drafter_empno
		      ,A.drafter_clsf
		      ,A.drafter_empnm
		      ,A.drafter_dept
		      ,A.bkmk_yn
		      ,A.atch_file_no
		      ,A.atrz_sj
		      ,A.atrz_cn
		      ,A.atrz_opinion
		      ,A.atrz_tmpr_stre_dt
		      ,A.atrz_drft_dt
		      ,A.atrz_compt_dt
		      ,A.atrz_rtrvl_dt
		      ,A.atrz_sttus_code
		      ,A.eltsgn_image
		      ,A.doc_form_no
		      ,A.atrz_delete_yn
		      ,A.schdul_reg_yn
		      ,L.atrz_ln_sn
		      ,L.sanctner_empno
		      ,L.sanctn_progrs_sttus_code
		
		      /* üî• Í∏∞ÏïàÏûê Î∂ÄÏÑú/ÏßÅÍ∏â  */
		      ,(SELECT CMMN_CODE_NM 
		         FROM COMMON_CODE 
		         WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
		           AND CMMN_CODE = DRAFTER_DEPT) AS DEPT_CODE_NM
		
		      ,(SELECT CMMN_CODE_NM 
		         FROM COMMON_CODE 
		         WHERE CMMN_CODE_GROUP = 'POSITION' 
		           AND CMMN_CODE = DRAFTER_CLSF) AS CLSF_CODE_NM
		
		      /* üî• Í≤∞Ïû¨Ïûê Ïù¥Î¶Ñ */
		      ,EMP.empl_nm AS sanctner_empnm
		
		      /* üî• Í≤∞Ïû¨Ïûê Î∂ÄÏÑúÎ™Ö */
		      ,(SELECT CMMN_CODE_NM 
		         FROM COMMON_CODE 
		         WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
		           AND CMMN_CODE = EMP.dept_code) AS sanctner_deptnm
		
		FROM (
		    SELECT *
		    FROM (
		        SELECT *
		        FROM ATRZ
		        WHERE drafter_empno = #{emplNo}
		          AND atrz_delete_yn = 'N'
		          AND atrz_sttus_code = '00'
		        ORDER BY atrz_drft_dt DESC
		    )
		    WHERE ROWNUM &lt;= 5
		) A
		LEFT JOIN atrz_line L ON A.atrz_doc_no = L.atrz_doc_no
		LEFT JOIN EMPLOYEE EMP ON L.sanctner_empno = EMP.empl_no
		
		/* ÏßÄÍ∏à Í≤∞Ïû¨ Ï∞®Î°ÄÏù∏ ÏÇ¨ÎûåÎßå ÎÇ®Í∏∞Í∏∞ */
		WHERE L.sanctn_progrs_sttus_code = '00'
		  AND NOT EXISTS (
		      SELECT 1
		      FROM atrz_line L2
		      WHERE L2.atrz_doc_no = L.atrz_doc_no
		        AND L2.atrz_ln_sn &lt; L.atrz_ln_sn
		        AND L2.sanctn_progrs_sttus_code = '00'
		  )
		
		ORDER BY A.atrz_drft_dt DESC
	</select>
	
	<!-- Í∏∞ÏïàÏôÑÎ£åÎ¨∏ÏÑú ÏµúÏã†Ïàú5Í∞ú -->
	<select id="atrzMinCompltedList" resultMap="atrzMap" parameterType="string">
		SELECT *   				/* AtrzMapper.atrzMinCompltedList  */
			FROM (
			  SELECT 	
			        A.atrz_doc_no
			        ,A.atrz_sj
			        ,A.atrz_cn
			        ,A.atrz_drft_dt
			        ,A.atrz_compt_dt
			        ,A.atrz_rtrvl_dt
			        ,A.atrz_sttus_code
			        ,A.drafter_empno
			        ,A.drafter_empnm
			        ,A.drafter_clsf
			        ,A.drafter_dept
			        ,(SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = DRAFTER_DEPT) as DEPT_CODE_NM
          			,(SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = DRAFTER_CLSF) as CLSF_CODE_NM
			    FROM ATRZ A
			    WHERE A.drafter_empno = #{emplNo}
			      AND A.atrz_sttus_code = '10'
			    ORDER BY A.atrz_compt_dt DESC
			)
			WHERE ROWNUM &lt;= 5
	</select>
	
	<!--approval ÏàòÏã†Î¨∏ÏÑúÌï®Ï†ÑÏûêÍ≤∞Ïû¨ -->
	<!-- Í≤∞Ïû¨ ÎåÄÍ∏∞Ï§ëÏù∏ Î¨∏ÏÑúÎ¶¨Ïä§Ìä∏ (Í≤∞Ïû¨ÎåÄÍ∏∞Î¨∏ÏÑú) -->
	<select id="atrzApprovalList" parameterType="hashMap" resultMap="atrzMap">
	    SELECT U.*					/* AtrzMapper.atrzApprovalList */
	    FROM (
	        WITH my_turn_lines AS (
	            SELECT L.*
	            FROM atrz_line L
	            WHERE L.sanctner_empno = #{emplNo}
	              AND L.sanctn_progrs_sttus_code = '00'
	              AND L.atrz_ty = '1'
	              AND NOT EXISTS (
	                  SELECT 1
	                  FROM atrz_line L2
	                  WHERE L2.atrz_doc_no = L.atrz_doc_no
	                    AND L2.atrz_ln_sn &lt; L.atrz_ln_sn
	                    AND L2.atrz_ty = '1'
	                    AND L2.sanctn_progrs_sttus_code NOT IN ('10', '60')
	              )
	        )
	        SELECT 
	            ROW_NUMBER() OVER (ORDER BY A.atrz_drft_dt DESC) AS RNUM,
	            A.atrz_doc_no,
	            A.drafter_empno,
	            A.drafter_clsf,
	            A.drafter_empnm,
	            A.drafter_dept,
	            A.bkmk_yn,
	            A.atch_file_no,
	            A.atrz_sj,
	            A.atrz_cn,
	            A.atrz_opinion,
	            A.atrz_tmpr_stre_dt,
	            A.atrz_drft_dt,
	            A.atrz_compt_dt,
	            A.atrz_rtrvl_dt,
	            A.atrz_sttus_code,
	            A.eltsgn_image,
	            A.doc_form_no,
	            A.atrz_delete_yn,
	            A.schdul_reg_yn,
	            L.atrz_ln_sn,
	            L.sanctner_empno,
	            L.sanctn_progrs_sttus_code,
	            L.atrz_ty,
	            L.dcrb_author_yn,
	            DF.DOC_FORM_NM,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM
	        FROM ATRZ A
	        JOIN my_turn_lines L ON A.atrz_doc_no = L.atrz_doc_no
	        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	        WHERE A.atrz_compt_dt IS NULL
	          AND A.atrz_sttus_code = '00'
	        
	        <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
	        <if test="keyword != null and keyword != ''">
	            <choose>
	                <when test="searchType == 'title'">
	                    AND A.atrz_sj LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'drafterName'">
	                    AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'drafterDeptName'">
	                    AND (SELECT CMMN_CODE_NM 
	                         FROM COMMON_CODE 
	                         WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
	                           AND CMMN_CODE = A.drafter_dept) 
	                        LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'formName'">
	                    AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
	                </when>
	            </choose>
	        </if>
	
	        <!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
	        <if test="duration != null and duration != 'all'">
	            <choose>
	                <when test="duration == 'period'">
	                    <if test="fromDate != null and fromDate != ''">
	                        AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
	                    </if>
	                    <if test="toDate != null and toDate != ''">
	                        AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
	                    </if>
	                </when>
	                <when test="duration == '1'">
	                    AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -1)
	                </when>
	                <when test="duration == '6'">
	                    AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -6)
	                </when>
	                <when test="duration == '12'">
	                    AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -12)
	                </when>
	            </choose>
	        </if>
	    ) U
	    WHERE U.RNUM BETWEEN (#{currentPage} * 10) - (10 - 1) AND (#{currentPage} * 10)
	</select>
	
	<!-- 
	Í≤∞Ïû¨ÎåÄÍ∏∞Î¨∏ÏÑúÎ™©Î°ù ÌñâÏùò Ïàò
	public int approvalTotal(String emplNo)
	 -->
	<select id="approvalTotal" parameterType="hashMap" resultType="int">
		  WITH my_turn_lines AS (			/* AtrzMapper.approvalTotal */
	        SELECT L.*
	        FROM atrz_line L
	        WHERE L.sanctner_empno = #{emplNo}
	          AND L.sanctn_progrs_sttus_code = '00'
	          AND L.atrz_ty = '1'
	          AND NOT EXISTS (
	              SELECT 1
	              FROM atrz_line L2
	              WHERE L2.atrz_doc_no = L.atrz_doc_no
	                AND L2.atrz_ln_sn &lt; L.atrz_ln_sn
	                AND L2.atrz_ty = '1'
	                AND L2.sanctn_progrs_sttus_code NOT IN ('10', '60')
	          )
	    ),
	    waiting_docs AS (
	        SELECT A.*, DF.DOC_FORM_NM
	        FROM ATRZ A
	        JOIN my_turn_lines L ON A.atrz_doc_no = L.atrz_doc_no
	        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	        WHERE A.atrz_compt_dt IS NULL
	          AND A.atrz_sttus_code IS NOT NULL
	    )
	    SELECT COUNT(*)
	    FROM waiting_docs A
	    WHERE 1=1
	
	    <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
	    <if test="keyword != null and keyword != ''">
	        <choose>
	            <when test="searchType == 'title'">
	                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterName'">
	                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterDeptName'">
	                AND (SELECT CMMN_CODE_NM 
	                     FROM COMMON_CODE 
	                     WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
	                       AND CMMN_CODE = A.drafter_dept) 
	                    LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'formName'">
	                AND A.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
	            </when>
	        </choose>
	    </if>
	
	    <!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
	    <if test="duration != null and duration != 'all'">
	        <choose>
	            <when test="duration == 'period'">
	                <if test="fromDate != null and fromDate != ''">
	                    AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
	                </if>
	                <if test="toDate != null and toDate != ''">
	                    AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
	                </if>
	            </when>
	            <when test="duration == '1'">
	                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -1)
	            </when>
	            <when test="duration == '6'">
	                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -6)
	            </when>
	            <when test="duration == '12'">
	                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -12)
	            </when>
	        </choose>
	    </if>
	</select>
		
	<!-- Ï∞∏Ï°∞ÎåÄÍ∏∞Î¨∏ÏÑú -->
	<select id="atrzReferList" resultMap="atrzMap" parameterType="hashMap">
			SELECT U.*			/* AtrzMapper.atrzReferList */
	FROM
	(
		WITH my_turn_lines AS (  
			SELECT L.*
			FROM atrz_line L
			WHERE L.sanctner_empno = #{emplNo}
			  AND L.sanctn_progrs_sttus_code = '00'
			  AND L.atrz_ty = '0'
		)
		SELECT  ROW_NUMBER() OVER(ORDER BY A.atrz_drft_dt DESC) RNUM
		      ,A.atrz_doc_no
		      ,A.drafter_empno
		      ,A.drafter_clsf
		      ,A.drafter_empnm
		      ,A.drafter_dept
		      ,A.bkmk_yn
		      ,A.atch_file_no
		      ,A.atrz_sj
		      ,A.atrz_cn
		      ,A.atrz_opinion
		      ,A.atrz_tmpr_stre_dt
		      ,A.atrz_drft_dt
		      ,A.atrz_compt_dt
		      ,A.atrz_rtrvl_dt
		      ,A.atrz_sttus_code
		      ,A.eltsgn_image
		      ,A.doc_form_no
		      ,A.atrz_delete_yn
		      ,A.schdul_reg_yn
		      ,L.atrz_ln_sn
		      ,L.sanctner_empno
		      ,L.atrz_ty
		      ,L.sanctn_progrs_sttus_code
		      ,(SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM
		      ,(SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM
		FROM ATRZ A
		JOIN my_turn_lines L ON A.atrz_doc_no = L.atrz_doc_no
		LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
		WHERE A.atrz_delete_yn = 'N'
		  AND A.atrz_sttus_code = '00'
		  
		<!-- Í≤ÄÏÉâÏ°∞Í±¥ -->
		<if test="keyword != null and keyword != ''">
		    <choose>
		        <when test="searchType == 'title'">
		            AND A.atrz_sj LIKE '%' || #{keyword} || '%'
		        </when>
		        <when test="searchType == 'drafterName'">
		            AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
		        </when>
		        <when test="searchType == 'drafterDeptName'">
		            AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept)
					LIKE '%' || #{keyword} || '%'
		        </when>
		        <when test="searchType == 'formName'">
		            AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
		        </when>
		    </choose>
		</if>

		<!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
		<if test="duration != null and duration != 'all'">
		    <choose>
		        <when test="duration == 'period'">
			        <if test="fromDate != null and fromDate != ''">
			            AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
			        </if>
			        <if test="toDate != null and toDate != ''">
			            AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
			        </if>
		        </when>
		        <when test="duration == '1'">
		            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
		        </when>
		        <when test="duration == '6'">
		            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
		        </when>
		        <when test="duration == '12'">
		            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
		        </when>
		    </choose>
		</if>
		
	) U
	WHERE U.RNUM BETWEEN (#{currentPage}*10) - (10-1) AND (#{currentPage}*10)
	</select>
	
	<!-- 
	Ï∞∏Ï°∞ÎåÄÍ∏∞Î¨∏ÏÑúÎ™©Î°ù ÌñâÏùò Ïàò
	public int approvalTotal(String emplNo)
	 -->
	<select id="referTotal" parameterType="hashMap" resultType="int">
		 WITH refer_docs AS (  				/* AtrzMapper.referTotal */
		        SELECT A.*, DF.DOC_FORM_NM
		        FROM atrz_line L
		        JOIN atrz A ON A.atrz_doc_no = L.atrz_doc_no
		        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
		        WHERE A.atrz_delete_yn = 'N'
		          AND A.atrz_sttus_code = '00'
		          AND L.sanctner_empno = #{emplNo}
		          AND L.atrz_ty = '0'
		    )
		    SELECT COUNT(*)
		    FROM refer_docs A
		    WHERE 1=1
		
		    <!-- Í≤ÄÏÉâÏ°∞Í±¥ -->
		    <if test="keyword != null and keyword != ''">
		        <choose>
		            <when test="searchType == 'title'">
		                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'drafterName'">
		                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'drafterDeptName'">
		                AND (SELECT CMMN_CODE_NM 
		                     FROM COMMON_CODE 
		                     WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
		                       AND CMMN_CODE = A.drafter_dept)
		                    LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'formName'">
		                AND A.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
		            </when>
		        </choose>
		    </if>
		
		    <!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
		    <if test="duration != null and duration != 'all'">
		        <choose>
		            <when test="duration == 'period'">
		                <if test="fromDate != null and fromDate != ''">
		                    AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
		                </if>
		                <if test="toDate != null and toDate != ''">
		                    AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
		                </if>
		            </when>
		            <when test="duration == '1'">
		                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -1)
		            </when>
		            <when test="duration == '6'">
		                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -6)
		            </when>
		            <when test="duration == '12'">
		                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -12)
		            </when>
		        </choose>
		    </if>
	</select>	
	
	<!-- Í≤∞Ïû¨ÏòàÏ†ïÎ¨∏ÏÑú -->
	<select id="atrzExpectedList" parameterType="hashMap" resultMap="atrzMap" >
		 SELECT U.*						/* AtrzMapper.atrzExpectedList */
    FROM (
        WITH waiting_for_my_turn AS (
            SELECT L.*
            FROM atrz_line L
            WHERE L.sanctner_empno = #{emplNo}
              AND L.atrz_ty = '1'
              AND EXISTS (
                  SELECT 1
                  FROM atrz_line L2
                  WHERE L2.atrz_doc_no = L.atrz_doc_no
                    AND L2.atrz_ln_sn &lt; L.atrz_ln_sn
                    AND L2.atrz_ty = '1'
                    AND L2.sanctn_progrs_sttus_code = '00'
              )
        )
        SELECT 
            ROW_NUMBER() OVER (ORDER BY A.atrz_drft_dt DESC) AS RNUM,
            A.atrz_doc_no,
            A.drafter_empno,
            A.drafter_clsf,
            A.drafter_empnm,
            A.drafter_dept,
            A.bkmk_yn,
            A.atch_file_no,
            A.atrz_sj,
            A.atrz_cn,
            A.atrz_opinion,
            A.atrz_tmpr_stre_dt,
            A.atrz_drft_dt,
            A.atrz_compt_dt,
            A.atrz_rtrvl_dt,
            A.atrz_sttus_code,
            A.eltsgn_image,
            A.doc_form_no,
            A.atrz_delete_yn,
            A.schdul_reg_yn,
            L.atrz_ln_sn,
            L.sanctner_empno,
            L.sanctn_progrs_sttus_code,
            L.atrz_ty,
            L.dcrb_author_yn,
            DF.DOC_FORM_NM,
            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM,
            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM
        FROM ATRZ A
        JOIN waiting_for_my_turn L ON A.atrz_doc_no = L.atrz_doc_no
        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
        WHERE A.atrz_compt_dt IS NULL
          AND A.atrz_sttus_code = '00'
          AND A.atrz_delete_yn = 'N'
        
        <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
		<if test="keyword != null and keyword != ''">
		    <choose>
		        <when test="searchType == 'title'">
		            AND A.atrz_sj LIKE '%' || #{keyword} || '%'
		        </when>
		        <when test="searchType == 'drafterName'">
		            AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
		        </when>
		        <when test="searchType == 'drafterDeptName'">
		           AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept)
       				LIKE '%' || #{keyword} || '%'
		        </when>
		        <when test="searchType == 'formName'">
		            AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
		            <!-- ÎòêÎäî Í≤∞Ïû¨ÏñëÏãùÎ™ÖÏù¥ Îã§Î•∏ ÌÖåÏù¥Î∏îÏóêÏÑú Ï°∞Ïù∏ÎêúÎã§Î©¥ Í±∞Í∏∞ÏÑú Í∞ÄÏ†∏Ïò§ÎèÑÎ°ù Ï≤òÎ¶¨ -->
		        </when>
		    </choose>
		</if>

       	<!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
		<if test="duration != null and duration != 'all'">
		    <choose>
		        <when test="duration == 'period'">
				    <if test="fromDate != null and fromDate != ''">
				        AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
				    </if>
				    <if test="toDate != null and toDate != ''">
				        AND A.atrz_drft_dt <![CDATA[ <= ]]>TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
				    </if>
		        </when>
		        <when test="duration == '1'">
		            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
		        </when>
		        <when test="duration == '6'">
		            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
		        </when>
		        <when test="duration == '12'">
		            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
		        </when>
		    </choose>
		</if>	
    ) U
    WHERE U.RNUM BETWEEN (#{currentPage}*10) - (10-1) AND (#{currentPage}*10)
	</select>
	<!-- 
	Í≤∞Ïû¨ÏòàÏ†ïÎ¨∏ÏÑúÎ™©Î°ù ÌñâÏùò Ïàò
	public int approvalTotal(String emplNo)
	 -->
	<select id="expectedTotal" parameterType="hashMap" resultType="int">
   WITH expected_docs AS (  /* AtrzMapper.expectedTotal */
        SELECT A.*, DF.DOC_FORM_NM
        FROM ATRZ A
        LEFT JOIN atrz_line L ON A.atrz_doc_no = L.atrz_doc_no
        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
        WHERE A.atrz_compt_dt IS NULL
          AND A.atrz_sttus_code = '00'
          AND L.sanctner_empno = #{emplNo}
          AND L.atrz_ty = '1'
          AND EXISTS (
              SELECT 1
              FROM atrz_line L2
              WHERE L2.atrz_doc_no = A.atrz_doc_no
                AND L2.atrz_ln_sn &lt; L.atrz_ln_sn
                AND L2.atrz_ty = '1'
                AND L2.sanctn_progrs_sttus_code = '00'
          )
    )
    SELECT COUNT(*)
    FROM expected_docs A
    WHERE 1 = 1

    <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
    <if test="keyword != null and keyword != ''">
        <choose>
            <when test="searchType == 'title'">
                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'drafterName'">
                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'drafterDeptName'">
                AND (SELECT CMMN_CODE_NM 
                     FROM COMMON_CODE 
                     WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
                       AND CMMN_CODE = A.drafter_dept)
                    LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'formName'">
                AND A.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
            </when>
        </choose>
    </if>

    <!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
    <if test="duration != null and duration != 'all'">
        <choose>
            <when test="duration == 'period'">
                <if test="fromDate != null and fromDate != ''">
                    AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
                </if>
                <if test="toDate != null and toDate != ''">
                    AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
                </if>
            </when>
            <when test="duration == '1'">
                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -1)
            </when>
            <when test="duration == '6'">
                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -6)
            </when>
            <when test="duration == '12'">
                AND A.atrz_drft_dt >= ADD_MONTHS(SYSDATE, -12)
            </when>
        </choose>
    </if>
	</select>	
	
	<!-- document Í∞úÏù∏Î¨∏ÏÑúÌï® -->
	<!-- Í∏∞ÏïàÎ¨∏ÏÑúÌï® -->	
	<select id="atrzAllSubmitList" parameterType="hashMap" resultMap="atrzMap">
	SELECT U.*
	    FROM (
	        WITH my_submissions AS (
	            SELECT A.*
	            FROM ATRZ A
	            WHERE A.drafter_empno = #{emplNo}  <!-- Í∏∞ÏïàÏûê ÏÇ¨Î≤à -->
	              AND A.atrz_delete_yn = 'N'  <!-- ÏÇ≠Ï†úÎêòÏßÄ ÏïäÏùÄ Î¨∏ÏÑú -->
	              AND A.atrz_sttus_code IN ('00', '10', '20', '30', '40')  <!-- Í≤∞Ïû¨ ÏßÑÌñâ Ï§ëÏù∏ ÏÉÅÌÉú -->
	        )
	        SELECT 
	            ROW_NUMBER() OVER (ORDER BY A.atrz_drft_dt DESC) AS RNUM,  <!-- ÎÇ†Ïßú ÎÇ¥Î¶ºÏ∞®ÏàúÏúºÎ°ú Ï†ïÎ†¨ -->
	            A.atrz_doc_no,
	            A.drafter_empno,
	            A.drafter_clsf,
	            A.drafter_empnm,
	            A.drafter_dept,
	            A.bkmk_yn,
	            A.atch_file_no,
	            A.atrz_sj,
	            A.atrz_cn,
	            A.atrz_opinion,
	            A.atrz_tmpr_stre_dt,
	            A.atrz_drft_dt,
	            A.atrz_compt_dt,
	            A.atrz_rtrvl_dt,
	            A.atrz_sttus_code,
	            A.eltsgn_image,
	            A.doc_form_no,
	            A.atrz_delete_yn,
	            A.schdul_reg_yn,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM,  <!-- Î∂ÄÏÑúÎ™Ö Ï°∞Ìöå -->
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM,  <!-- ÏßÅÍ∏âÎ™Ö Ï°∞Ìöå -->
	            DF.DOC_FORM_NM  <!-- Í≤∞Ïû¨ ÏñëÏãùÎ™Ö -->
	        FROM my_submissions A
	        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	        WHERE 1=1
	       <!-- Í≤ÄÏÉâÏ°∞Í±¥ -->
		    <if test="keyword != null and keyword != ''">
		        <choose>
		            <when test="searchType == 'title'">
		                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'drafterName'">
		                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'drafterDeptName'">
		                AND (SELECT CMMN_CODE_NM 
		                     FROM COMMON_CODE 
		                     WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
		                       AND CMMN_CODE = A.drafter_dept)
		                LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'formName'">
		                AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
		            </when>
		        </choose>
		    </if>
		
		    <!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
		    <if test="duration != null and duration != 'all'">
		        <choose>
		            <when test="duration == 'period'">
		                <if test="fromDate != null and fromDate != ''">
		                    AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
		                </if>
		                <if test="toDate != null and toDate != ''">
		                    AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
		                </if>
		            </when>
		            <when test="duration == '1'">
		                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
		            </when>
		            <when test="duration == '6'">
		                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
		            </when>
		            <when test="duration == '12'">
		                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
		            </when>
		        </choose>
		    </if>
	    ) U
	    WHERE U.RNUM BETWEEN ( (#{currentPage} - 1) * #{size} ) + 1 AND (#{currentPage} * #{size})
	</select>
	
	
	<!-- Í∏∞ÏïàÏßÑÌñâÎ¨∏ÏÑú ÌñâÏùòÏàò -->
	<select id="allSubmitTotal" parameterType="hashMap" resultType="int">
	    WITH my_turn_lines AS (  /* AtrzMapper.allSubmitTotal */
	        SELECT A.*
	        FROM ATRZ A
	        WHERE A.drafter_empno = #{emplNo}
	          AND A.atrz_delete_yn = 'N'
	          AND A.atrz_sttus_code IN ('00', '10', '20', '30', '40')
	    )
	    SELECT COUNT(*)
	    FROM my_turn_lines A
	    LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	    WHERE 1=1
	    <!-- Í≤ÄÏÉâÏ°∞Í±¥ -->
	    <if test="keyword != null and keyword != ''">
	        <choose>
	            <when test="searchType == 'title'">
	                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterName'">
	                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterDeptName'">
	                AND (SELECT CMMN_CODE_NM 
	                     FROM COMMON_CODE 
	                     WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
	                       AND CMMN_CODE = A.drafter_dept)
	                LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'formName'">
	                AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
	            </when>
	        </choose>
	    </if>
	
	    <!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
	    <if test="duration != null and duration != 'all'">
	        <choose>
	            <when test="duration == 'period'">
	                <if test="fromDate != null and fromDate != ''">
	                    AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
	                </if>
	                <if test="toDate != null and toDate != ''">
	                    AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
	                </if>
	            </when>
	            <when test="duration == '1'">
	                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
	            </when>
	            <when test="duration == '6'">
	                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
	            </when>
	            <when test="duration == '12'">
	                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
	            </when>
	        </choose>
	    </if>
	</select>
	

	<!-- ÏûÑÏãúÏ†ÄÏû•Ìïú Î¨∏ÏÑúÎ¶¨Ïä§Ìä∏ (ÏûÑÏãúÏ†ÄÏû•Ìï®) -->
	<select id="atrzStorageList" parameterType="hashMap" resultMap="atrzMap">
		SELECT U.*				/* AtrzMapper.atrzStorageList */
	    FROM (
	        WITH temp_storage AS (
	            SELECT A.*
	            FROM ATRZ A
	            WHERE A.drafter_empno = #{emplNo}
	              AND A.atrz_sttus_code = '99'
	              AND A.atrz_delete_yn = 'N'
	        )
	        SELECT 
	            ROW_NUMBER() OVER (ORDER BY A.atrz_tmpr_stre_dt DESC) AS RNUM,
	            A.atrz_doc_no,
	            A.drafter_empno,
	            A.drafter_clsf,
	            A.drafter_empnm,
	            A.drafter_dept,
	            A.bkmk_yn,
	            A.atch_file_no,
	            A.atrz_sj,
	            A.atrz_cn,
	            A.atrz_opinion,
	            A.atrz_tmpr_stre_dt,
	            A.atrz_drft_dt,
	            A.atrz_compt_dt,
	            A.atrz_rtrvl_dt,
	            A.atrz_sttus_code,
	            A.eltsgn_image,
	            A.doc_form_no,
	            A.atrz_delete_yn,
	            A.schdul_reg_yn,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM,
	            DF.DOC_FORM_NM
	        FROM temp_storage A
	        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	        WHERE 1=1
	        <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
	        <if test="keyword != null and keyword != ''">
	            <choose>
	                <when test="searchType == 'title'">
	                    AND A.atrz_sj LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'drafterName'">
	                    AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'drafterDeptName'">
	                    AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'formName'">
	                    AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
	                </when>
	            </choose>
	        </if>
	
	        <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
	        <if test="duration != null and duration != 'all'">
	            <choose>
	                <when test="duration == 'period'">
	                    <if test="fromDate != null and fromDate != ''">
	                        AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
	                    </if>
	                    <if test="toDate != null and toDate != ''">
	                        AND A.atrz_tmpr_stre_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
	                    </if>
	                </when>
	                <when test="duration == '1'">
	                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
	                </when>
	                <when test="duration == '6'">
	                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
	                </when>
	                <when test="duration == '12'">
	                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
	                </when>
	            </choose>
	        </if>
	
	    ) U
	    WHERE U.RNUM BETWEEN (#{currentPage}*10) - (10-1) AND (#{currentPage}*10)
	</select>
	
	<!-- ÏûÑÏãúÏ†ÄÏû• Î™©Î°ù Ï¥ù Í∞úÏàò Ï°∞Ìöå -->
	<select id="storageTotal" parameterType="hashMap" resultType="int">
	   WITH temp_storage AS (			/* AtrzMapper.storageTotal */
        SELECT A.*
        FROM ATRZ A
        WHERE A.drafter_empno = #{emplNo}
          AND A.atrz_sttus_code = '99'
          AND A.atrz_delete_yn = 'N'
    )
    SELECT COUNT(*)  <!-- Ï†ÑÏ≤¥ Í±¥ÏàòÎ•º ÏÑ∏Îäî Î∂ÄÎ∂Ñ -->
    FROM temp_storage A
    LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	WHERE 1=1
    <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
    <if test="keyword != null and keyword != ''">
        <choose>
            <when test="searchType == 'title'">
                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'drafterName'">
                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'drafterDeptName'">
                AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'formName'">
                AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
            </when>
        </choose>
    </if>

    <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
    <if test="duration != null and duration != 'all'">
        <choose>
            <when test="duration == 'period'">
                <if test="fromDate != null and fromDate != ''">
                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
                </if>
                <if test="toDate != null and toDate != ''">
                    AND A.atrz_tmpr_stre_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
                </if>
            </when>
            <when test="duration == '1'">
                AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
            </when>
            <when test="duration == '6'">
                AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
            </when>
            <when test="duration == '12'">
                AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
            </when>
        </choose>
    </if>
</select>
	
	<!-- Í≤∞Ïû¨Î¨∏ÏÑúÌï® Î™©Î°ù-->
	<select id="atrzAllApprovalList" parameterType="hashMap" resultMap="atrzMap">
		SELECT U.*				/* AtrzMapper.atrzAllApprovalList */
	    FROM (
	        WITH approval_docs AS (
	            SELECT A.*
	            FROM ATRZ A
	            LEFT JOIN ATRZ_LINE L ON A.atrz_doc_no = L.atrz_doc_no
	            WHERE L.sanctner_empno = #{emplNo}
	              AND L.atrz_ty = '1'
	              AND L.sanctn_progrs_sttus_code IN ('10','20','60')
	              AND A.atrz_delete_yn = 'N'
	        )
	        SELECT 
	            ROW_NUMBER() OVER (ORDER BY A.atrz_drft_dt DESC) AS RNUM,
	            A.atrz_doc_no,
	            A.drafter_empno,
	            A.drafter_clsf,
	            A.drafter_empnm,
	            A.drafter_dept,
	            A.bkmk_yn,
	            A.atch_file_no,
	            A.atrz_sj,
	            A.atrz_cn,
	            A.atrz_opinion,
	            A.atrz_tmpr_stre_dt,
	            A.atrz_drft_dt,
	            A.atrz_compt_dt,
	            A.atrz_rtrvl_dt,
	            A.atrz_sttus_code,
	            A.eltsgn_image,
	            A.doc_form_no,
	            A.atrz_delete_yn,
	            A.schdul_reg_yn,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM,
	            DF.DOC_FORM_NM
	        FROM approval_docs A
	        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	        WHERE 1=1
	          <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
			<if test="keyword != null and keyword != ''">
		        <choose>
		            <when test="searchType == 'title'">
		                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'drafterName'">
		                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'drafterDeptName'">
		                AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept)
		                LIKE '%' || #{keyword} || '%'
		            </when>
		            <when test="searchType == 'formName'">
		                AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
		            </when>
		        </choose>
		    </if>
		    
		    <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
		    <if test="duration != null and duration != 'all'">
		        <choose>
		            <when test="duration == 'period'">
		                <if test="fromDate != null and fromDate != ''">
		                    AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
		                </if>
		                <if test="toDate != null and toDate != ''">
		                    AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
		                </if>
		            </when>
		            <when test="duration == '1'">
		                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
		            </when>
		            <when test="duration == '6'">
		                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
		            </when>
		            <when test="duration == '12'">
		                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
		            </when>
		        </choose>
		    </if>
			    ) U
			    WHERE U.RNUM BETWEEN (#{currentPage}*10) - (10-1) AND (#{currentPage}*10)
	</select>
	<!-- Í≤∞Ïû¨Î¨∏ÏÑúÌï® ÌñâÏùòÏàò -->
	<select id="allApprovalTotal" parameterType="hashMap" resultType="int">
	    WITH approval_docs AS (  <!-- AtrzMapper.atrzAllApprovalCount -->
        SELECT A.*
        FROM ATRZ A
        LEFT JOIN ATRZ_LINE L ON A.atrz_doc_no = L.atrz_doc_no
        WHERE L.sanctner_empno = #{emplNo}
          AND L.atrz_ty = '1'
          AND L.sanctn_progrs_sttus_code IN ('10', '20', '60')  <!-- Í≤∞Ïû¨ ÏßÑÌñâÏÉÅÌÉú -->
          AND A.atrz_delete_yn = 'N'
    )
    SELECT COUNT(*)
    FROM approval_docs A
    LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
    WHERE 1=1
    <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
    <if test="keyword != null and keyword != ''">
        <choose>
            <when test="searchType == 'title'">
                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'drafterName'">
                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'drafterDeptName'">
                AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept)
                LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'formName'">
                AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
            </when>
        </choose>
    </if>
    
    <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
    <if test="duration != null and duration != 'all'">
        <choose>
            <when test="duration == 'period'">
                <if test="fromDate != null and fromDate != ''">
                    AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
                </if>
                <if test="toDate != null and toDate != ''">
                    AND A.atrz_drft_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
                </if>
            </when>
            <when test="duration == '1'">
                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
            </when>
            <when test="duration == '6'">
                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
            </when>
            <when test="duration == '12'">
                AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
            </when>
        </choose>
    </if>
</select>
	
	<!-- Í∏∞ÏïàÏ§ëÏù∏ Î¨∏ÏÑúÎ¶¨Ïä§Ìä∏ Î¨∏ÏÑúÎ¶¨Ïä§Ìä∏ (Í∏∞ÏïàÏßÑÌñâÎ¨∏ÏÑú) -->
	<select id="atrzSubmitList" resultMap="atrzMap" parameterType="hashMap">
		SELECT 	/* AtrzMapper.atrzSubmitList ÏøºÎ¶¨ÏàòÏ†ïÏôÑÎ£å */
	        A.atrz_doc_no
	        ,A.atrz_sj
	        ,A.atrz_cn
	        ,A.atrz_drft_dt
	        ,A.atrz_compt_dt
	        ,A.atrz_rtrvl_dt
	        ,A.atrz_sttus_code
	        ,A.drafter_empno
	        ,A.drafter_empnm
	        ,A.drafter_clsf
	        ,A.drafter_dept
	        ,L.atrz_ln_sn
	        ,L.sanctner_empno
	        ,L.sanctn_progrs_sttus_code
	        ,(SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = DRAFTER_DEPT) as DEPT_CODE_NM
            ,(SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = DRAFTER_CLSF) as CLSF_CODE_NM
	    FROM ATRZ A
	    LEFT JOIN atrz_line L
	        on A.atrz_doc_no = L.atrz_doc_no
	    WHERE 1 = 1
	     AND A.drafter_empno = #{emplNo}
	     AND A.atrz_sttus_code = '00'
	    ORDER BY A.atrz_drft_dt DESC
	</select>
	
	<!-- Í∏∞ÏïàÎ¨∏ÏÑú Î™©Î°ù Ï¥ù Í∞úÏàò Ï°∞Ìöå -->
	<select id="atrzSubmitTotal" parameterType="hashMap" resultType="int">
	    SELECT COUNT(*)
	    FROM (
	        SELECT 1
	        FROM ATRZ A
	             LEFT JOIN atrz_line L ON A.atrz_doc_no = L.atrz_doc_no
	        WHERE 1 = 1
	          AND A.drafter_empno = #{emplNo}
	          AND A.atrz_sttus_code = '00'
	         <!-- Í≤ÄÏÉâÏ°∞Í±¥ -->
			<if test="keyword != null and keyword != ''">
			    <choose>
			        <when test="searchType == 'title'">
			            AND A.atrz_sj LIKE '%' || #{keyword} || '%'
			        </when>
			        <when test="searchType == 'drafterName'">
			            AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
			        </when>
			        <when test="searchType == 'drafterDeptName'">
			           AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept)
        				LIKE '%' || #{keyword} || '%'
			        </when>
			        <when test="searchType == 'formName'">
			            AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
			            <!-- ÎòêÎäî Í≤∞Ïû¨ÏñëÏãùÎ™ÖÏù¥ Îã§Î•∏ ÌÖåÏù¥Î∏îÏóêÏÑú Ï°∞Ïù∏ÎêúÎã§Î©¥ Í±∞Í∏∞ÏÑú Í∞ÄÏ†∏Ïò§ÎèÑÎ°ù Ï≤òÎ¶¨ -->
			        </when>
			    </choose>
			</if>
			<!-- ÎÇ†Ïßú ÌïÑÌÑ∞ -->
			<if test="duration != null and duration != 'all'">
			    <choose>
			        <when test="duration == 'period'">
					    <if test="fromDate != null and fromDate != ''">
					        AND A.atrz_drft_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
					    </if>
					    <if test="toDate != null and toDate != ''">
					        AND A.atrz_drft_dt <![CDATA[ <= ]]>TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
					    </if>
			        </when>
			        <when test="duration == '1'">
			            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
			        </when>
			        <when test="duration == '6'">
			            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
			        </when>
			        <when test="duration == '12'">
			            AND A.atrz_drft_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
			        </when>
			    </choose>
			</if>	
	    )
	</select>
	
	<!-- Í≤∞Ïû¨ÏôÑÎ£åÌï® -->
	<select id="atrzCompletedList" parameterType="hashMap" resultMap="atrzMap">
	    SELECT U.*
	    FROM (
	        WITH complete_docs AS (
	            SELECT A.*
	            FROM ATRZ A
	            WHERE A.drafter_empno = #{emplNo}
	              AND A.atrz_sttus_code = '10'
	              AND A.atrz_delete_yn = 'N'
	        )
	        SELECT 
	            ROW_NUMBER() OVER (ORDER BY A.atrz_compt_dt DESC) AS RNUM,
	            A.atrz_doc_no,
	            A.drafter_empno,
	            A.drafter_clsf,
	            A.drafter_empnm,
	            A.drafter_dept,
	            A.bkmk_yn,
	            A.atch_file_no,
	            A.atrz_sj,
	            A.atrz_cn,
	            A.atrz_opinion,
	            A.atrz_tmpr_stre_dt,
	            A.atrz_drft_dt,
	            A.atrz_compt_dt,
	            A.atrz_rtrvl_dt,
	            A.atrz_sttus_code,
	            A.eltsgn_image,
	            A.doc_form_no,
	            A.atrz_delete_yn,
	            A.schdul_reg_yn,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM,
	            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM,
	            DF.DOC_FORM_NM
	        FROM complete_docs A
	        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
	        WHERE 1=1
	
	        <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
	        <if test="keyword != null and keyword != ''">
	            <choose>
	                <when test="searchType == 'title'">
	                    AND A.atrz_sj LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'drafterName'">
	                    AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'drafterDeptName'">
	                    AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchType == 'formName'">
	                    AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
	                </when>
	            </choose>
	        </if>
	
	        <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
	        <if test="duration != null and duration != 'all'">
	            <choose>
	                <when test="duration == 'period'">
	                    <if test="fromDate != null and fromDate != ''">
	                        AND A.atrz_compt_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
	                    </if>
	                    <if test="toDate != null and toDate != ''">
	                        AND A.atrz_compt_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
	                    </if>
	                </when>
	                <when test="duration == '1'">
	                    AND A.atrz_compt_dt >= ADD_MONTHS(SYSDATE, -1)
	                </when>
	                <when test="duration == '6'">
	                    AND A.atrz_compt_dt >= ADD_MONTHS(SYSDATE, -6)
	                </when>
	                <when test="duration == '12'">
	                    AND A.atrz_compt_dt >= ADD_MONTHS(SYSDATE, -12)
	                </when>
	            </choose>
	        </if>
	    ) U
	    WHERE U.RNUM BETWEEN (#{currentPage}*10) - (10-1) AND (#{currentPage}*10)
	</select>
	
	<!-- Í≤∞Ïû¨ÏôÑÎ£åÎ¨∏ÏÑú Î™©Î°ù Ï¥ù Í∞úÏàò Ï°∞Ìöå -->
	<select id="completedTotal" parameterType="hashMap" resultType="int">
	   WITH completed_docs AS (  <!-- AtrzMapper.atrzCompletedCount -->
        SELECT A.*, DF.DOC_FORM_NM
        FROM ATRZ A
        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
        WHERE A.drafter_empno = #{emplNo}
          AND A.atrz_sttus_code = '10'  <!-- ÏôÑÎ£åÎêú Î¨∏ÏÑú -->
          AND A.atrz_delete_yn = 'N'
	    )
	    SELECT COUNT(*)
	    FROM completed_docs A
	    WHERE 1=1
	
	    <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
	    <if test="keyword != null and keyword != ''">
	        <choose>
	            <when test="searchType == 'title'">
	                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterName'">
	                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterDeptName'">
	                AND (SELECT CMMN_CODE_NM 
	                     FROM COMMON_CODE 
	                     WHERE CMMN_CODE_GROUP = 'DEPARTMENT' 
	                       AND CMMN_CODE = A.drafter_dept) 
	                    LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'formName'">
	                AND A.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
	            </when>
	        </choose>
	    </if>
	
	    <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
	    <if test="duration != null and duration != 'all'">
	        <choose>
	            <when test="duration == 'period'">
	                <if test="fromDate != null and fromDate != ''">
	                    AND A.atrz_compt_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
	                </if>
	                <if test="toDate != null and toDate != ''">
	                    AND A.atrz_compt_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
	                </if>
	            </when>
	            <when test="duration == '1'">
	                AND A.atrz_compt_dt >= ADD_MONTHS(SYSDATE, -1)
	            </when>
	            <when test="duration == '6'">
	                AND A.atrz_compt_dt >= ADD_MONTHS(SYSDATE, -6)
	            </when>
	            <when test="duration == '12'">
	                AND A.atrz_compt_dt >= ADD_MONTHS(SYSDATE, -12)
	            </when>
	        </choose>
	    </if>
	</select>
	
	<!-- Î∞òÎ†§Î¨∏ÏÑúÌï® -->
	<select id="atrzCompanionList" parameterType="hashMap" resultMap="atrzMap">
    SELECT U.*
    FROM (
        WITH companion_docs AS (
            SELECT A.*
            FROM ATRZ A
            WHERE A.drafter_empno = #{emplNo}
              AND A.atrz_sttus_code = '20'
              AND A.atrz_delete_yn = 'N'
        )
        SELECT 
            ROW_NUMBER() OVER (ORDER BY A.atrz_tmpr_stre_dt DESC) AS RNUM,
            A.atrz_doc_no,
            A.drafter_empno,
            A.drafter_clsf,
            A.drafter_empnm,
            A.drafter_dept,
            A.bkmk_yn,
            A.atch_file_no,
            A.atrz_sj,
            A.atrz_cn,
            A.atrz_opinion,
            A.atrz_tmpr_stre_dt,
            A.atrz_drft_dt,
            A.atrz_compt_dt,
            A.atrz_rtrvl_dt,
            A.atrz_sttus_code,
            A.eltsgn_image,
            A.doc_form_no,
            A.atrz_delete_yn,
            A.schdul_reg_yn,
            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) AS DEPT_CODE_NM,
            (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'POSITION' AND CMMN_CODE = A.drafter_clsf) AS CLSF_CODE_NM,
            DF.DOC_FORM_NM
        FROM companion_docs A
        LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
        WHERE 1=1
        <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
        <if test="keyword != null and keyword != ''">
            <choose>
                <when test="searchType == 'title'">
                    AND A.atrz_sj LIKE '%' || #{keyword} || '%'
                </when>
                <when test="searchType == 'drafterName'">
                    AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
                </when>
                <when test="searchType == 'drafterDeptName'">
                    AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) LIKE '%' || #{keyword} || '%'
                </when>
                <when test="searchType == 'formName'">
                    AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
                </when>
            </choose>
        </if>

        <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
        <if test="duration != null and duration != 'all'">
            <choose>
                <when test="duration == 'period'">
                    <if test="fromDate != null and fromDate != ''">
                        AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
                    </if>
                    <if test="toDate != null and toDate != ''">
                        AND A.atrz_tmpr_stre_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
                    </if>
                </when>
                <when test="duration == '1'">
                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
                </when>
                <when test="duration == '6'">
                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
                </when>
                <when test="duration == '12'">
                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
                </when>
            </choose>
        </if>
    ) U
    WHERE U.RNUM BETWEEN (#{currentPage}*10) - (10-1) AND (#{currentPage}*10)
	</select>
	
	<!-- Î∞òÎ†§Î¨∏ÏÑúÌï® ÌñâÏùòÏàò -->
	<select id="companionTotal" parameterType="hashMap" resultType="int">
		WITH companion_docs AS (  <!-- AtrzMapper.atrzCompanionCount -->
	        SELECT A.*
	        FROM ATRZ A
	        WHERE A.drafter_empno = #{emplNo}
	          AND A.atrz_sttus_code = '20'  <!-- Î∞òÎ†§Îêú Î¨∏ÏÑú -->
	          AND A.atrz_delete_yn = 'N'
	    )
	    SELECT COUNT(*)
	    FROM companion_docs A
	    LEFT JOIN DOC_FORM DF ON A.doc_form_no = DF.DOC_FORM_NO
		WHERE 1=1
	    <!-- Í≤ÄÏÉâ Ï°∞Í±¥ -->
	    <if test="keyword != null and keyword != ''">
	        <choose>
	            <when test="searchType == 'title'">
	                AND A.atrz_sj LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterName'">
	                AND A.drafter_empnm LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'drafterDeptName'">
	                AND (SELECT CMMN_CODE_NM FROM COMMON_CODE WHERE CMMN_CODE_GROUP = 'DEPARTMENT' AND CMMN_CODE = A.drafter_dept) LIKE '%' || #{keyword} || '%'
	            </when>
	            <when test="searchType == 'formName'">
	                AND DF.DOC_FORM_NM LIKE '%' || #{keyword} || '%'
	            </when>
	        </choose>
	    </if>
	    <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
	    <if test="duration != null and duration != 'all'">
	        <choose>
	            <when test="duration == 'period'">
	                <if test="fromDate != null and fromDate != ''">
	                    AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> TO_DATE(#{fromDate}, 'YYYY-MM-DD')
	                </if>
	                <if test="toDate != null and toDate != ''">
	                    AND A.atrz_tmpr_stre_dt <![CDATA[ <= ]]> TO_DATE(#{toDate}, 'YYYY-MM-DD') + 1
	                </if>
	            </when>
	            <when test="duration == '1'">
	                AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -1)
	            </when>
	            <when test="duration == '6'">
	                AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -6)
	            </when>
	            <when test="duration == '12'">
	                AND A.atrz_tmpr_stre_dt <![CDATA[ >= ]]> ADD_MONTHS(SYSDATE, -12)
	            </when>
	        </choose>
	    </if>
	</select>
	
	

	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ÌÖåÏù¥Î∏î Îì±Î°ù(Í≤∞Ïû¨ÏÑ† ÏßÄÏ†ï Ïãú Ï†ÑÏûêÍ≤∞Ïû¨Î¨∏ÏÑú Î≤àÌò∏Î•º ÏÉùÏÑ±Ìï¥Ï§å) 
			SELECT CREATE_DOC_NO(#{docFormNm}) AS CREATE_DOC_NO FROM DUAL
	-->
	<insert id="insertAtrz" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		<selectKey resultType="string" order="BEFORE" keyProperty="atrzDocNo">
			SELECT CREATE_DOC_NO(#{docFormNm}) FROM DUAL
		</selectKey>
	
		INSERT INTO     /* AtrzMapper.insertAtrz */
	<!-- 	Ï†ÑÏûêÍ≤∞Ïû¨Î≤àÌò∏, Í∏∞ÏïàÏûêÏÇ¨Î≤à, ÏßÅÍ∏âÏΩîÎìú, Ïù¥Î¶Ñ, Î∂ÄÏÑúÏΩîÎìú,  -->
			 ATRZ
		(
			  atrz_doc_no
			, drafter_empno
			, drafter_clsf
			, drafter_empnm
			, drafter_dept
			, bkmk_yn
			, atch_file_no
			, doc_form_no
		)
		VALUES
		(
			#{atrzDocNo}
			,#{emplNo}
			,#{clsfCode}
			,#{emplNm}
			,#{deptCode}
			,'N'
			, #{atchFileNo}
			, #{docFormNo}
		)
	</insert>
	<insert id="insertAtrzMy" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		<selectKey resultType="string" order="BEFORE" keyProperty="atrzDocNo">
			SELECT CREATE_DOC_NO(#{docFormNm}) FROM DUAL
		</selectKey>
	
		INSERT INTO     /* AtrzMapper.insertAtrzMy */
	<!-- 	Ï†ÑÏûêÍ≤∞Ïû¨Î≤àÌò∏, Í∏∞ÏïàÏûêÏÇ¨Î≤à, ÏßÅÍ∏âÏΩîÎìú, Ïù¥Î¶Ñ, Î∂ÄÏÑúÏΩîÎìú,  -->
			 ATRZ
		(
			  atrz_doc_no
			, drafter_empno
			, drafter_clsf
			, drafter_empnm
			, drafter_dept
			, bkmk_yn
			, atch_file_no
			, doc_form_no
		)
		VALUES
		(
			#{atrzDocNo}
			,#{emplNo}
			,#{clsfCode}
			,#{emplNm}
			,#{deptCode}
			,'N'
			, #{atchFileNo}
			, #{docFormNo}
		)
	</insert>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ÌÖåÏù¥Î∏î Îì±Î°ù(Ïù¥ÎØ∏ Ï†ÑÏûêÍ≤∞Ïû¨ Î¨∏ÏÑú Î≤àÌò∏Í∞Ä Ï°¥Ïû¨Ìï®) 
	atrzSj, atrzCn, atrzDrftDt, atrzSttusCode
			AtrzVO(atrzDocNo=H_20250410_00003, drafterEmpno=null, drafterClsf=null, drafterEmpnm=null, drafterDept=null, bkmkYn=null, 
			atchFileNo=0, atrzSj=ÎØ∏Î¶¨ÏûëÏÑ±Ìïú Ï†úÎ™©ÏûÖÎãàÎã§., atrzCn=sfda, atrzOpinion=null, atrzTmprStreDt=null, atrzDrftDt=null, atrzComptDt=null,
			 atrzRtrvlDt=null, atrzSttusCode=null, eltsgnImage=null, docFormNo=1, atrzDeleteYn=null, schdulRegYn=null, docFormNm=H,
		emplNoArr=null, emplNo=20250004, emplNm=Í∏∏Ï§ÄÌù¨, clsfCode=02, clsfCodeNm=null, deptCode=91, deptCodeNm=null, uploadFile=null,
		atrzLineVOList=null, holidayVO=null, spendingVO=null, emplDetailList=null)
	-->
	<update id="insertUpdateAtrz" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		UPDATE atrz     /* AtrzMapper.insertUpdateAtrz */
	<!-- 	Ï≤®Î∂ÄÌååÏùºÎ≤àÌò∏, Ï†úÎ™©, ÎÇ¥Ïö©, Í∏∞ÏïàÏùºÏãú, ÏßÑÌñâÏÉÅÌÉú, ÏñëÏãùÎ¨∏ÏÑúÎ≤àÌò∏  -->
		SET   atrz_sttus_code = '00'
			, atrz_sj = #{atrzSj}
			, atrz_cn = #{atrzCn}
			, atrz_drft_dt = SYSDATE
			<if test="atchFileNo!=null and atchFileNo!=''">
				, atch_file_no = #{atchFileNo}
			</if>
        WHERE atrz_doc_no = #{atrzDocNo}		
	</update>
	
	<update id="insertUpdateMyAtrz" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		UPDATE atrz     /* AtrzMapper.insertUpdateMyAtrz */
	<!-- 	Ï≤®Î∂ÄÌååÏùºÎ≤àÌò∏, Ï†úÎ™©, ÎÇ¥Ïö©, Í∏∞ÏïàÏùºÏãú, ÏßÑÌñâÏÉÅÌÉú, ÏñëÏãùÎ¨∏ÏÑúÎ≤àÌò∏  -->
		SET   atrz_sttus_code = '10'
			, atrz_sj = #{atrzSj}
			, atrz_cn = #{atrzCn}
			, atrz_drft_dt = SYSDATE
			, atrz_compt_dt = SYSDATE
        WHERE atrz_doc_no = #{atrzDocNo}		
	</update>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨Í≤∞Ïû¨ÏÑ† Îì±Î°ù -->
	<insert id="insertAtrzLine" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzLineVO">
		INSERT INTO  /* AtrzMapper.insertAtrzLine */
			atrz_line 
			(
			  atrz_doc_no
			, atrz_ln_sn
			, sanctner_empno
			, sanctner_clsf_code
			, atrz_ty
			, sanctn_progrs_sttus_code
			, dcrb_author_yn
			)
		VALUES
			(
			  #{atrzDocNo}
			, #{atrzLnSn}
			, #{sanctnerEmpno}
			, #{sanctnerClsfCode}
			, #{atrzTy}
			, #{sanctnProgrsSttusCode}
			, #{dcrbAuthorYn}
			)	
	</insert>
	
	<insert id="insertMyAtrzLine" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzLineVO">
		INSERT INTO  /* AtrzMapper.insertMyAtrzLine */
			atrz_line 
			(
			  atrz_doc_no
			, atrz_ln_sn
			, sanctner_empno
			, sanctner_clsf_code
			, atrz_ty
			, sanctn_progrs_sttus_code
			, dcrb_author_yn
			, sanctn_confm_dt
			, sanctn_opinion
			)
		VALUES
			(
			  #{atrzDocNo}
			, #{atrzLnSn}
			, #{sanctnerEmpno}
			, #{sanctnerClsfCode}
			, #{atrzTy}
			, #{sanctnProgrsSttusCode}
			, #{dcrbAuthorYn}
			, SYSDATE
			, 'Í∏âÏó¨Î™ÖÏÑ∏ÏÑú'
			)	
	</insert>
	
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú Îì±Î°ù -->
	<insert id="insertHoliday" parameterType="kr.or.ddit.sevenfs.vo.atrz.HolidayVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="holiActplnNo">
			SELECT NVL(MAX(HOLI_ACTPLN_NO),0)+1 FROM DOCUM_HOLIDAY
		</selectKey>
		INSERT INTO /* AtrzMapper.insertHoliday */
			docum_holiday    
			(
			  HOLI_ACTPLN_NO
			, ATRZ_DOC_NO
			, HOLI_CODE
			, HOLI_START
			, HOLI_END
			, HOLI_USE_DAYS
			)
		VALUES
			(
			  #{holiActplnNo}
			, #{atrzDocNo}
			, #{holiCode}
			, #{holiStart}
			, #{holiEnd}
			, #{holiUseDays}
			)
	</insert>
	
	
	<select id="readHoCnt" parameterType="string" resultType="double">
		SELECT YRYC_REMNDR_DAYCNT
		FROM VACATION
		WHERE EMPL_NO = #{empNo}
		AND YRYC_YEAR = TO_CHAR(SYSDATE, 'YYYY')
	</select>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ ÏûÑÏãúÏ†ÄÏû• update -->
	<update id="storageDocUpdate" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
	    UPDATE ATRZ
	    SET
	        ATRZ_SJ = #{atrzSj},
	        ATRZ_CN = #{atrzCn},
	        ATRZ_TMPR_STRE_DT = SYSDATE,
	        ATRZ_STTUS_CODE = '99',
	        ATCH_FILE_NO = #{atchFileNo}
	    WHERE ATRZ_DOC_NO = #{atrzDocNo}
	</update>
	
	
	<!-- ÏûÑÏãúÏ†ÄÏû• Í≤∞Ïû¨ÏÑ† Ïù∏ÏÑúÌä∏ -->
		<!-- Ï†ÑÏûêÍ≤∞Ïû¨Í≤∞Ïû¨ÏÑ† Îì±Î°ù -->
		<insert id="updateAtrzLine" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzLineVO">
			INSERT INTO  /* AtrzMapper.insertAtrzLine */
				atrz_line 
				(
				  atrz_doc_no
				, atrz_ln_sn
				, sanctner_empno
				, sanctner_clsf_code
				, atrz_ty
				, sanctn_progrs_sttus_code
				, dcrb_author_yn
				)
			VALUES
				(
				#{atrzDocNo}
				, #{atrzLnSn}
				, #{sanctnerEmpno}
				, #{sanctnerClsfCode}
				, #{atrzTy}
				, '00'
				, #{dcrbAuthorYn}
				)	
		</insert>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ ÏûÑÏãúÏ†ÄÏû• Ïù∏ÏÑúÌä∏ -->
	<insert id="atrzDocStorage" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
	       INSERT INTO 
	       			ATRZ (
		         ATRZ_DOC_NO
		        ,DRAFTER_EMPNO
		        ,DRAFTER_CLSF
		        ,DRAFTER_EMPNM
		        ,DRAFTER_DEPT
		        ,ATCH_FILE_NO
		        ,ATRZ_SJ
		        ,ATRZ_CN
		        ,ATRZ_TMPR_STRE_DT
		        ,ATRZ_STTUS_CODE
		        ,DOC_FORM_NO
		    )
		    VALUES (
		         #{atrzDocNo}
		        ,#{drafterEmpno}
		        ,#{drafterClsf}
		        ,#{drafterEmpnm}
		        ,#{drafterDept}
		        ,#{atchFileNo}
		        ,#{atrzSj}
		        ,#{atrzCn}
		        ,SYSDATE
		        ,'99'
		        ,#{docFormNo}
		    )
	</insert>
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú ÏûÑÏãúÏ†ÄÏû• murge into -->
	<insert id="insertOrUpdateHoliday" parameterType="kr.or.ddit.sevenfs.vo.atrz.HolidayVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="holiActplnNo">
			SELECT NVL(MAX(HOLI_ACTPLN_NO),0)+1 FROM DOCUM_HOLIDAY
		</selectKey>
	    MERGE INTO DOCUM_HOLIDAY A
	    USING (SELECT #{atrzDocNo} AS ATRZ_DOC_NO FROM dual) B
	    ON (A.ATRZ_DOC_NO = B.ATRZ_DOC_NO)
	    WHEN MATCHED THEN
	        UPDATE SET
	            HOLI_CODE = #{holiCode}
	            ,HOLI_START = #{holiStart}
	            ,HOLI_END = #{holiEnd}
	            ,HOLI_USE_DAYS = #{holiUseDays}
	    WHEN NOT MATCHED THEN
	        INSERT (
	        	  HOLI_ACTPLN_NO
	            , ATRZ_DOC_NO
	            , HOLI_CODE
	            , HOLI_START
	            , HOLI_END
	            , HOLI_USE_DAYS
	        ) VALUES (
		          #{holiActplnNo}
				, #{atrzDocNo}
	            , #{holiCode}
	            , #{holiStart}
	            , #{holiEnd}
	            , #{holiUseDays}
	        )
	</insert>
	
	<!-- ÏßÄÏ∂úÍ≤∞ÏùòÏÑú ÏûÑÏãúÏ†ÄÏû• murge into -->
	<insert id="insertOrUpdateSpending" parameterType="kr.or.ddit.sevenfs.vo.atrz.SpendingVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="spendingReportNo">
			SELECT NVL(MAX(SPENDING_REPORT_NO),0)+1 FROM DOCUM_SPENDING
		</selectKey>
	    MERGE INTO DOCUM_SPENDING A
	    USING (SELECT #{atrzDocNo} AS ATRZ_DOC_NO FROM dual) B
	    ON (A.ATRZ_DOC_NO = B.ATRZ_DOC_NO)
	    WHEN MATCHED THEN
	        UPDATE SET
	              EXPENSE_ORDER = #{expenseOrder}
	            , EXPENSE_DATE = #{expenseDate}
	            , ITEM_DESCRIPTION = #{itemDescription}
	            , ITEM_QUANTITY = #{itemQuantity}
	            , ITEM_AMOUNT = #{itemAmount}
	            , PAYMENT_METHOD = #{paymentMethod}
	    WHEN NOT MATCHED THEN
	        INSERT (
	        	  SPENDING_REPORT_NO
	        	, ATRZ_DOC_NO
	        	, EXPENSE_ORDER
	        	, EXPENSE_DATE
	        	, ITEM_DESCRIPTION
	        	, ITEM_QUANTITY
	        	, ITEM_AMOUNT
	        	, PAYMENT_METHOD
	        ) VALUES (
		          #{spendingReportNo}
				, #{atrzDocNo}
	            , #{expenseOrder}
	            , #{expenseDate}
	            , #{itemDescription}
	            , #{itemQuantity}
	            , #{itemAmount}
	            , #{paymentMethod}
	        )
	</insert>
	
	
	<!-- Í≤∞Ïû¨ÏÑ† ÏÇ≠Ï†ú -->
	<delete id="deleteAtrzLineByDocNo" parameterType="string">
	    DELETE FROM ATRZ_LINE WHERE ATRZ_DOC_NO = #{atrzDocNo}
	</delete>
	<!-- ÌååÏùº ÏÉÅÏÑ∏Î≥¥Í∏∞Î•º ÏúÑÌïúÍ≤É -->
	<select id="getAtchFile" parameterType="long" resultType="kr.or.ddit.sevenfs.vo.AttachFileVO">
		SELECT
		    atch_file_no,
		    file_sn,
		    file_stre_path,
		    file_nm,
		    file_stre_nm,
		    file_extsn,
		    file_mime,
		    file_size,
		    file_view_size,
		    dwld_co,
		    empl_no,
		    file_use_yn,
		    file_creat_dt
		FROM
		    attatch_file
		WHERE 
		    atch_file_no = #{atchFileNo}
		</select>
	
	
	
	<!-- ÏûÑÏãúÏ†ÄÏû• selectÏ°∞Ìöå ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
		<!-- Ï†ÑÏûêÍ≤∞Ïû¨(ÏûÑÏãúÏ†ÄÏû•Ìè¨Ìï®) ÏÉÅÏÑ∏Ï°∞Ìöå -->
	<select id="getAtrzStorage" parameterType="string" resultMap="atrzMap">
		SELECT 	/* AtrzMapper.getAtrzStorage */
		     A.ATRZ_DOC_NO
		    ,A.DRAFTER_EMPNO
		    ,A.DRAFTER_CLSF
		    ,A.DRAFTER_EMPNM
		    ,A.DRAFTER_DEPT
		    ,A.BKMK_YN
		    ,A.ATCH_FILE_NO
		    ,A.ATRZ_SJ
		    ,A.ATRZ_CN
		    ,A.ATRZ_OPINION
		    ,A.ATRZ_TMPR_STRE_DT
		    ,A.ATRZ_DRFT_DT
		    ,A.ATRZ_COMPT_DT
		    ,A.ATRZ_RTRVL_DT
		    ,A.ATRZ_STTUS_CODE
		    ,A.ELTSGN_IMAGE
		    ,A.DOC_FORM_NO
		    ,A.ATRZ_DELETE_YN
		    ,A.SCHDUL_REG_YN
		    ,H.HOLI_ACTPLN_NO
		    ,H.HOLI_CODE
		    ,H.HOLI_START
		    ,H.HOLI_END
		    ,H.HOLI_USE_DAYS
		    ,S.SPENDING_REPORT_NO
		    ,S.EXPENSE_ORDER
		    ,S.EXPENSE_DATE
		    ,S.ITEM_DESCRIPTION
		    ,S.ITEM_QUANTITY
		    ,S.ITEM_AMOUNT
		    ,S.PAYMENT_METHOD
		    ,SL.SALARY_NO
		    ,SL.BASE_SALARY
		    ,SL.MEAL_ALLOWANCE
		    ,SL.INCOME_TAX
		    ,SL.LOCAL_TAX
		    ,SL.PENSION
		    ,SL.EMPLOYMENT_INS
		    ,SL.HEALTH_INS
		    ,SL.CARE_INS
		    ,SL.PAY_DATE
		    ,B.BANK_ACC_NO
		    ,B.OLD_BANK
		    ,B.OLD_ACC_NO
		    ,B.NEW_BANK
		    ,B.NEW_ACC_NO
		    ,B.REASON
		    ,D.DRAFT_NO
		    ,EC.EMP_CERT_NO
		    ,R.RESIGNATION_NO
		    ,L.ATRZ_LN_SN
		    ,L.SANCTNER_EMPNO
		    ,L.SANCTNER_CLSF_CODE
		    ,L.CONTD_EMPNO
		    ,L.CONTD_CLSF_CODE
		    ,L.DCRB_MAN_EMPNO
		    ,L.DCRB_MAN_CLSF_CODE
		    ,L.ATRZ_TY
		    ,L.SANCTN_PROGRS_STTUS_CODE
		    ,L.DCRB_AUTHOR_YN
		    ,L.CONTD_AUTHOR_YN
		    ,L.SANCTN_OPINION
		    ,L.ELTSGN_IMAGE AS LINE_ELTSGN_IMAGE
		    ,L.SANCTN_CONFM_DT
		
		FROM ATRZ A
		LEFT JOIN DOCUM_HOLIDAY H ON A.ATRZ_DOC_NO = H.ATRZ_DOC_NO
		LEFT JOIN DOCUM_SPENDING S ON A.ATRZ_DOC_NO = S.ATRZ_DOC_NO
		LEFT JOIN DOCUM_SALARY SL ON A.ATRZ_DOC_NO = SL.ATRZ_DOC_NO
		LEFT JOIN DOCUM_BANK_ACCOUNT B ON A.ATRZ_DOC_NO = B.ATRZ_DOC_NO
		LEFT JOIN DOCUM_DRAFT D ON A.ATRZ_DOC_NO = D.ATRZ_DOC_NO
		LEFT JOIN DOCUM_EMP_CERTIFICATE EC ON A.ATRZ_DOC_NO = EC.ATRZ_DOC_NO
		LEFT JOIN DOCUM_RESIGNATION R ON A.ATRZ_DOC_NO = R.ATRZ_DOC_NO
		LEFT JOIN ATRZ_LINE L ON A.ATRZ_DOC_NO = L.ATRZ_DOC_NO
		
		WHERE A.ATRZ_DOC_NO = #{atrzDocNo}
	</select>
	
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú ÏûÑÏãúÏ†ÄÏû•ÌõÑ ÏóÖÎç∞Ïù¥Ìä∏ -->
	<update id="updateHolidayAtrz" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		    UPDATE ATRZ
		      SET 
		    	ATRZ_SJ = #{atrzSj}
		    	,ATRZ_CN = #{atrzCn}
		        ,DRAFTER_CLSF = #{clsfCode}
		        ,DRAFTER_DEPT = #{deptCode}
		        ,ATCH_FILE_NO = #{atchFileNo}
		        ,ATRZ_DRFT_DT = SYSDATE
		        ,ATRZ_STTUS_CODE = '10'
		    WHERE ATRZ_DOC_NO = #{atrzDocNo}
	</update>
	
	
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú ÏûÑÏãúÏ†ÄÏû•ÏÉÅÏÑ∏Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò®ÌõÑ Îã§Ïãú insertÎ•º ÏúÑÌïúÍ≤É murge into -->
	<insert id="updateOrInsertHoliday" parameterType="kr.or.ddit.sevenfs.vo.atrz.HolidayVO">
	    MERGE INTO DOCUM_HOLIDAY A
	    USING (SELECT #{atrzDocNo} AS ATRZ_DOC_NO FROM dual) B
	    ON (A.ATRZ_DOC_NO = B.ATRZ_DOC_NO)
	    WHEN MATCHED THEN
	        UPDATE SET
	             HOLI_CODE = #{holiCode}
	            ,HOLI_START = #{holiStart}
	            ,HOLI_END = #{holiEnd}
	            ,HOLI_USE_DAYS = #{holiUseDays}
	    WHEN NOT MATCHED THEN
	        INSERT (
	        	  HOLI_ACTPLN_NO
	            , ATRZ_DOC_NO
	            , HOLI_CODE
	            , HOLI_START
	            , HOLI_END
	            , HOLI_USE_DAYS
	        ) VALUES (
		         #{holiActplnNo}
				, #{atrzDocNo}
	            , #{holiCode}
	            , #{holiStart}
	            , #{holiEnd}
	            , #{holiUseDays}
	        )
	</insert>
	<!-- Ïû¨Í∏∞ÏïàÏãú Î¨∏ÏÑúÏ†ïÎ≥¥Í∞ÄÏ†∏Ïò§Í∏∞ -->
	<select id="selectDocumentReturn" parameterType="string" resultMap="atrzMap">
	SELECT 	/* AtrzMapper.selectDocumentReturn */
	    A.ATRZ_DOC_NO
	    ,A.DRAFTER_EMPNO
	    ,A.DRAFTER_CLSF
	    ,A.DRAFTER_EMPNM
	    ,A.DRAFTER_DEPT
	    ,A.BKMK_YN
	    ,A.ATCH_FILE_NO
	    ,A.ATRZ_SJ
	    ,A.ATRZ_CN
	    ,A.ATRZ_OPINION
	    ,A.ATRZ_TMPR_STRE_DT
	    ,A.ATRZ_DRFT_DT
	    ,A.ATRZ_COMPT_DT
	    ,A.ATRZ_RTRVL_DT
	    ,A.ATRZ_STTUS_CODE
	    ,A.ELTSGN_IMAGE
	    ,A.DOC_FORM_NO
	    ,A.ATRZ_DELETE_YN
	    ,A.SCHDUL_REG_YN
	    ,H.HOLI_ACTPLN_NO
	    ,H.HOLI_CODE
	    ,H.HOLI_START
	    ,H.HOLI_END
	    ,H.HOLI_USE_DAYS
	    ,S.SPENDING_REPORT_NO
	    ,S.EXPENSE_ORDER
	    ,S.EXPENSE_DATE
	    ,S.ITEM_DESCRIPTION
	    ,S.ITEM_QUANTITY
	    ,S.ITEM_AMOUNT
	    ,S.PAYMENT_METHOD
	    ,SL.SALARY_NO
	    ,SL.BASE_SALARY
	    ,SL.MEAL_ALLOWANCE
	    ,SL.INCOME_TAX, SL.LOCAL_TAX
	    ,SL.PENSION, SL.EMPLOYMENT_INS
	    ,SL.HEALTH_INS
	    ,SL.CARE_INS
	    ,SL.PAY_DATE
	    ,B.BANK_ACC_NO
	    ,B.OLD_BANK
	    ,B.OLD_ACC_NO
	    ,B.NEW_BANK
	    ,B.NEW_ACC_NO
	    ,B.REASON
	    ,D.DRAFT_NO
	    ,EC.EMP_CERT_NO
	    ,R.RESIGNATION_NO
	    ,L.ATRZ_LN_SN
	    ,L.SANCTNER_EMPNO
	    ,L.SANCTNER_CLSF_CODE
	    ,L.CONTD_EMPNO
	    ,L.CONTD_CLSF_CODE
	    ,L.DCRB_MAN_EMPNO
	    ,L.DCRB_MAN_CLSF_CODE
	    ,L.ATRZ_TY
	    ,L.SANCTN_PROGRS_STTUS_CODE
	    ,L.DCRB_AUTHOR_YN
	    ,L.CONTD_AUTHOR_YN
	    ,L.SANCTN_OPINION
	    ,L.ELTSGN_IMAGE AS LINE_ELTSGN_IMAGE
	    ,L.SANCTN_CONFM_DT
	
	FROM ATRZ A
	LEFT JOIN DOCUM_HOLIDAY H ON A.ATRZ_DOC_NO = H.ATRZ_DOC_NO
	LEFT JOIN DOCUM_SPENDING S ON A.ATRZ_DOC_NO = S.ATRZ_DOC_NO
	LEFT JOIN DOCUM_SALARY SL ON A.ATRZ_DOC_NO = SL.ATRZ_DOC_NO
	LEFT JOIN DOCUM_BANK_ACCOUNT B ON A.ATRZ_DOC_NO = B.ATRZ_DOC_NO
	LEFT JOIN DOCUM_DRAFT D ON A.ATRZ_DOC_NO = D.ATRZ_DOC_NO
	LEFT JOIN DOCUM_EMP_CERTIFICATE EC ON A.ATRZ_DOC_NO = EC.ATRZ_DOC_NO
	LEFT JOIN DOCUM_RESIGNATION R ON A.ATRZ_DOC_NO = R.ATRZ_DOC_NO
	LEFT JOIN ATRZ_LINE L ON A.ATRZ_DOC_NO = L.ATRZ_DOC_NO
	
	WHERE A.ATRZ_DOC_NO = #{atrzDocNo}
	</select>
	
	
	
	<!-- ÏßÄÏ∂úÍ≤∞ÏùòÏÑú Îì±Î°ù  -->
	<insert id="insertSpending" parameterType="kr.or.ddit.sevenfs.vo.atrz.SpendingVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="spendingReportNo">
			SELECT NVL(MAX(spending_report_no),0)+1 FROM docum_spending
		</selectKey>
		INSERT INTO /* AtrzMapper.insertSpending */
			docum_spending    
			(
			   spending_report_no
			 , atrz_doc_no
			 , expense_order
			 , expense_date
			 , item_description
			 , item_quantity
			 , item_amount
			 , payment_method
			)
		VALUES
			(
			  #{spendingReportNo}
			, #{atrzDocNo}
			, #{expenseOrder}
			, #{expenseDate}
			, #{itemDescription}
			, #{itemQuantity}
			, #{itemAmount}
			, #{paymentMethod}
			)
	</insert>
	
	<insert id="insertSalary" parameterType="kr.or.ddit.sevenfs.vo.atrz.SalaryVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="salaryNo">
			SELECT NVL(MAX(salary_no),0)+1 FROM docum_salary
		</selectKey>
		INSERT INTO 	/* AtrzMapper.insertSalary */
			docum_salary
			(
			  salary_no
			, atrz_doc_no
			, base_salary
			, meal_allowance
			, income_tax
			, local_tax
			, pension
			, employment_ins
			, health_ins
			, care_ins
			, pay_date
			, total_ded
			, total_pay
			, net_pay
			, bonus
			)
		VALUES
			(
			  #{salaryNo}
			, #{atrzDocNo}
			, #{baseSalary}
			, #{mealAllowance}
			, #{incomeTax}
			, #{localTax}
			, #{pension}
			, #{employmentIns}
			, #{healthIns}
			, #{careIns}
			, #{payDate}
			, #{totalPay}
			, #{totalDed}
			, #{netPay}
			, #{bonus}
			)
	</insert>
	
	
	<insert id="insertBankAccount" parameterType="kr.or.ddit.sevenfs.vo.atrz.BankAccountVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="bankAccNo">
			SELECT NVL(MAX(bank_acc_no),0)+1 FROM docum_bank_account
		</selectKey>
		INSERT INTO 	/* AtrzMapper.insertBankAccount */
			docum_bank_account
			(
			   bank_acc_no
			 , atrz_doc_no
			 , old_bank
			 , old_acc_no
			 , new_bank
			 , new_acc_no
			 , reason
			)
		VALUES
			(
			  #{bankAccNo}
			, #{atrzDocNo}
			, #{oldBank}
			, #{oldAccNo}
			, #{newBank}
			, #{newAccNo}
			, #{reason}
			)
	</insert>
	
	<insert id="insertDraft" parameterType="kr.or.ddit.sevenfs.vo.atrz.DraftVO">
		<selectKey resultType="int" order="BEFORE" keyProperty="draftNo">
			SELECT NVL(MAX(draft_no),0)+1 FROM docum_draft
		</selectKey>
		INSERT INTO 	/* AtrzMapper.insertDraft */
			docum_draft
			(
			   atrz_doc_no
			 , draft_no
			)
		VALUES
			(
			  #{atrzDocNo}
			, #{draftNo}
			)
	</insert>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ ÏÉÅÏÑ∏Ï°∞Ìöå -->
	<select id="selectAtrzDetail" parameterType="string" resultMap="atrzMap">
		 SELECT 	/* AtrzMapper.selectAtrzDetail */
             A.ATRZ_DOC_NO
            ,A.DRAFTER_EMPNO
            ,A.DRAFTER_CLSF
            ,A.DRAFTER_EMPNM
            ,A.DRAFTER_DEPT
            ,A.BKMK_YN
            ,A.ATCH_FILE_NO
            ,A.ATRZ_SJ
            ,A.ATRZ_CN
            ,A.ATRZ_OPINION
            ,A.ATRZ_TMPR_STRE_DT
            ,A.ATRZ_DRFT_DT
            ,A.ATRZ_COMPT_DT
            ,A.ATRZ_RTRVL_DT
            ,A.ATRZ_STTUS_CODE
            ,A.ELTSGN_IMAGE
            ,A.DOC_FORM_NO
            ,A.ATRZ_DELETE_YN
            ,A.SCHDUL_REG_YN
            ,H.HOLI_ACTPLN_NO
            ,H.HOLI_CODE
            ,H.HOLI_START
            ,H.HOLI_END
            ,H.HOLI_USE_DAYS
            ,S.SPENDING_REPORT_NO
            ,S.EXPENSE_ORDER
            ,S.EXPENSE_DATE
            ,S.ITEM_DESCRIPTION
            ,S.ITEM_QUANTITY
            ,S.ITEM_AMOUNT
            ,S.PAYMENT_METHOD
            ,SL.SALARY_NO
            ,SL.BASE_SALARY
            ,SL.MEAL_ALLOWANCE
            ,SL.INCOME_TAX
            ,SL.LOCAL_TAX
            ,SL.PENSION
            ,SL.EMPLOYMENT_INS
            ,SL.HEALTH_INS
            ,SL.CARE_INS
            ,SL.PAY_DATE
            ,SL.TOTAL_PAY
            ,SL.TOTAL_DED
            ,SL.NET_PAY
            ,B.BANK_ACC_NO
            ,B.OLD_BANK
            ,B.OLD_ACC_NO
            ,B.NEW_BANK
            ,B.NEW_ACC_NO
            ,B.REASON
            ,D.DRAFT_NO
            ,EC.EMP_CERT_NO
            ,R.RESIGNATION_NO
        FROM ATRZ A
        LEFT JOIN DOCUM_HOLIDAY H ON A.ATRZ_DOC_NO = H.ATRZ_DOC_NO
        LEFT JOIN DOCUM_SPENDING S ON A.ATRZ_DOC_NO = S.ATRZ_DOC_NO
        LEFT JOIN DOCUM_SALARY SL ON A.ATRZ_DOC_NO = SL.ATRZ_DOC_NO
        LEFT JOIN DOCUM_BANK_ACCOUNT B ON A.ATRZ_DOC_NO = B.ATRZ_DOC_NO
        LEFT JOIN DOCUM_DRAFT D ON A.ATRZ_DOC_NO = D.ATRZ_DOC_NO
        LEFT JOIN DOCUM_EMP_CERTIFICATE EC ON A.ATRZ_DOC_NO = EC.ATRZ_DOC_NO
        LEFT JOIN DOCUM_RESIGNATION R ON A.ATRZ_DOC_NO = R.ATRZ_DOC_NO
        
        WHERE A.ATRZ_DOC_NO = #{atrzDocNo}
	</select>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ÏÑ† ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
	<select id="selectAtrzLineList" parameterType="string" resultType="kr.or.ddit.sevenfs.vo.atrz.AtrzLineVO">
		SELECT     /* AtrzMapper.selectAtrzLineList */
             ATRZ_DOC_NO
            ,ATRZ_LN_SN
            ,SANCTNER_EMPNO
            ,SANCTNER_CLSF_CODE
            ,CONTD_EMPNO
            ,CONTD_CLSF_CODE
            ,DCRB_MAN_EMPNO
            ,DCRB_MAN_CLSF_CODE
            ,ATRZ_TY
            ,SANCTN_PROGRS_STTUS_CODE
            ,DCRB_AUTHOR_YN
            ,CONTD_AUTHOR_YN
            ,SANCTN_OPINION
            ,ELTSGN_IMAGE
            ,SANCTN_CONFM_DT
        FROM ATRZ_LINE
        WHERE ATRZ_DOC_NO = #{atrzDocNo}
        ORDER BY ATRZ_LN_SN
	</select>
	
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
	<select id="holidayDetail" parameterType="string" resultType="kr.or.ddit.sevenfs.vo.atrz.HolidayVO">
		    SELECT *		/* AtrzMapper.holidayDetail */
			    FROM (
			        SELECT 
			            HOLI_ACTPLN_NO
			            ,ATRZ_DOC_NO
			            ,HOLI_CODE
			            ,HOLI_START
			            ,HOLI_END
			            ,HOLI_USE_DAYS
			            ,ROW_NUMBER() OVER (ORDER BY HOLI_ACTPLN_NO DESC) AS RN
			        FROM DOCUM_HOLIDAY
			        WHERE ATRZ_DOC_NO = #{atrzDocNo}
			    )
			    WHERE RN = 1
	</select>
	
	<!-- ÏßÄÏ∂úÍ≤∞ÏùòÏÑú ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
	<select id="spendingDetail" parameterType="string" resultType="kr.or.ddit.sevenfs.vo.atrz.SpendingVO">
		    SELECT *		/* AtrzMapper.spendingDetail */
			    FROM (
			        SELECT 
			              SPENDING_REPORT_NO
			            , ATRZ_DOC_NO
			            , EXPENSE_ORDER
			            , EXPENSE_DATE
			            , ITEM_DESCRIPTION
			            , ITEM_QUANTITY
			            , ITEM_AMOUNT
			            , PAYMENT_METHOD
			            ,ROW_NUMBER() OVER (ORDER BY SPENDING_REPORT_NO DESC) AS RN
			        FROM DOCUM_SPENDING
			        WHERE ATRZ_DOC_NO = #{atrzDocNo}
			    )
			    WHERE RN = 1
	</select>
	<!-- Í∏âÏó¨Î™ÖÏÑ∏ÏÑú ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
	<select id="salaryDetail" parameterType="string" resultType="kr.or.ddit.sevenfs.vo.atrz.SalaryVO">
		    SELECT *		/* AtrzMapper.salaryDetail */
			    FROM (
			        SELECT 
			              SALARY_NO
			            , ATRZ_DOC_NO
			            , BASE_SALARY
			            , MEAL_ALLOWANCE
			            , INCOME_TAX
			            , LOCAL_TAX
			            , PENSION
			            , EMPLOYMENT_INS
			            , HEALTH_INS
			            , CARE_INS
			            , PAY_DATE
			            , TOTAL_PAY
			            , TOTAL_DED
			            , NET_PAY
			            , BONUS
			            ,ROW_NUMBER() OVER (ORDER BY SALARY_NO DESC) AS RN
			        FROM DOCUM_SALARY
			        WHERE ATRZ_DOC_NO = #{atrzDocNo}
			    )
			    WHERE RN = 1
	</select>
		<!-- ÏßÄÏ∂úÍ≤∞ÏùòÏÑú ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
	<select id="draftDetail" parameterType="string" resultType="kr.or.ddit.sevenfs.vo.atrz.DraftVO">
    SELECT *		/* AtrzMapper.draftDetail */
	    FROM (
	        SELECT 
	             DRAFT_NO
				,ATRZ_DOC_NO
	            ,ROW_NUMBER() OVER (ORDER BY DRAFT_NO DESC) AS RN
	        FROM DOCUM_DRAFT
	        WHERE ATRZ_DOC_NO = #{atrzDocNo}
	    )
	    WHERE RN = 1
	</select>
	
	<!-- ÎÇòÏùò Ï†ÑÏûêÍ≤∞Ïû¨ÏÑ† ÏÉÅÌô©(1Ìñâ)
	public AtrzLineVO getAtrzLineInfo(AtrzVO atrzVO) 
	ÎÇòÎäî Í≤∞Ïû¨Ìï¥Ïïº ÌïòÎÇò?
	1) Ï†Ñ Í≤∞Ïû¨ÏûêÍ∞Ä 10, 40Ïù∏Í∞Ä?
	
	AtrzVO(atrzDocNo=H_20250411_00003, drafterEmpno=null, drafterClsf=null, drafterEmpnm=null, drafterDept=null, bkmkYn=null, 
		 atchFileNo=0, atrzSj=null, atrzCn=null, atrzOpinion=null, atrzTmprStreDt=null, atrzDrftDt=null, atrzComptDt=null, atrzRtrvlDt=null, atrzSttusCode=null, 
		 eltsgnImage=null, docFormNo=0, atrzDeleteYn=null, schdulRegYn=null, docFormNm=null, emplNoArr=null, emplNo=20250000, emplNm=null, clsfCode=null, clsfCodeNm=null,
         deptCode=null, deptCodeNm=null, uploadFile=null, ..
	-->
	<select id="getAtrzLineInfo" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO" resultType="kr.or.ddit.sevenfs.vo.atrz.AtrzLineVO">
		WITH T AS(			/* AtrzMapper.getAtrzLineInfo */
		    SELECT A.ATRZ_LN_SN
		         , A.SANCTNER_EMPNO
		         , A.ATRZ_DOC_NO
		         , A.SANCTN_PROGRS_STTUS_CODE
		         , LAG(A.SANCTNER_EMPNO) OVER(ORDER BY A.ATRZ_LN_SN) BEF_SANCTNER_EMPNO
		         , LAG(A.SANCTN_PROGRS_STTUS_CODE) OVER(ORDER BY A.ATRZ_LN_SN) BEF_SANCTN_PROGRS_STTUS_CODE
		         , LEAD(A.SANCTNER_EMPNO) OVER(ORDER BY A.ATRZ_LN_SN) AFT_SANCTNER_EMPNO
		         , LEAD(A.SANCTN_PROGRS_STTUS_CODE) OVER(ORDER BY A.ATRZ_LN_SN) AFT_SANCTN_PROGRS_STTUS_CODE
		         , (SELECT MAX(B.ATRZ_LN_SN) FROM ATRZ_LINE B WHERE B.ATRZ_DOC_NO = #{atrzDocNo} AND B.DCRB_AUTHOR_YN = '0') MAX_ATRZ_LN_SN
		    FROM   ATRZ_LINE A
		    WHERE  A.ATRZ_DOC_NO = #{atrzDocNo}
		)
		SELECT T.*
		FROM T
		WHERE  T.SANCTNER_EMPNO = #{emplNo}
	</select>
	
	<!--H_20250411_00003 Î¨∏ÏÑúÏùò Í≤∞Ïû¨ÏÑ† Ï¥ù Ïä§ÌÉ≠Ïàò
	public int getMaxStep(AtrzVO atrzVO) 

	0 : ÏµúÏ¢ÖÍ≤∞Ïû¨ÏûêÍ∞Ä ÏïÑÎãò
	 -->
	<select id="getMaxStep" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO" resultType="int">
		SELECT
		    CASE 
		        WHEN AL.ATRZ_LN_SN = MAX_LINE.MAX_LN_SN THEN AL.ATRZ_LN_SN
		        ELSE 0
		    END AS RSLT
		FROM (
		    SELECT ATRZ_DOC_NO, TO_NUMBER(ATRZ_LN_SN) AS ATRZ_LN_SN
		    FROM ATRZ_LINE
		    WHERE ATRZ_DOC_NO = #{atrzDocNo}
		      AND SANCTNER_EMPNO = #{emplNo}
		      AND ATRZ_TY = '1'  /* Í≤∞Ïû¨ÏûêÎßå */
		) AL
		LEFT JOIN (
		    SELECT ATRZ_DOC_NO, MAX(TO_NUMBER(ATRZ_LN_SN)) AS MAX_LN_SN
		    FROM ATRZ_LINE
		    WHERE ATRZ_DOC_NO = #{atrzDocNo}
		      AND ATRZ_TY = '1'  /* Í≤∞Ïû¨ÏûêÎßå Í≥†Î†§ */
		    GROUP BY ATRZ_DOC_NO
		) MAX_LINE ON AL.ATRZ_DOC_NO = MAX_LINE.ATRZ_DOC_NO
	</select>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ÏÑ† ÏàòÏ†ï
		 AtrzVO(atrzDocNo=H_20250411_00003, drafterEmpno=null, drafterClsf=null, drafterEmpnm=null, drafterDept=null, bkmkYn=null, 
		 atchFileNo=0, atrzSj=null, atrzCn=null, atrzOpinion=null, atrzTmprStreDt=null, atrzDrftDt=null, atrzComptDt=null, atrzRtrvlDt=null, atrzSttusCode=null, 
		 eltsgnImage=null, docFormNo=0, atrzDeleteYn=null, schdulRegYn=null, docFormNm=null, emplNoArr=null, emplNo=20250000, emplNm=null, clsfCode=null, clsfCodeNm=null,
         deptCode=null, deptCodeNm=null, uploadFile=null, 
		  	atrzLineVOList=[AtrzLineVO(atrzDocNo=null, atrzLnSn=0, sanctnerEmpno=null, sanctnerClsfCode=null, contdEmpno=null, 
			  contdClsfCode=null, dcrbManEmpno=null, dcrbManClsfCode=null, atrzTy=null, sanctnProgrsSttusCode=null, dcrbAuthorYn=null, contdAuthorYn=null, 
			  sanctnOpinion=ÏäπÏù∏Ìï©ÎãàÎã§.,eltsgnImage=null, sanctnConfmDt=null, atrzLineList=null, sanctnerClsfNm=null, sanctnerEmpNm=null)
			  ], 
		 holidayVO=null, spendingVO=null, salaryVO=null, 
		 bankAccountVO=null, draftVO=null, emplDetailList=null, authorStatus=false, sanctnProgrsSttusCode=10)
	 -->
	 <!-- Í≤∞Ïû¨ÏäπÏù∏Ïãú -->
	<update id="atrzDetailAppUpdate" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		UPDATE atrz_line  /* AtrzMapper.atrzDetailAppUpdate */
		SET 
			 SANCTN_PROGRS_STTUS_CODE = 10
			,SANCTN_CONFM_DT = SYSDATE
			,SANCTN_OPINION = #{atrzLineVOList[0].sanctnOpinion}
		WHERE ATRZ_DOC_NO = #{atrzDocNo} AND SANCTNER_EMPNO = #{emplNo}
	</update>

	<!-- ÏµúÏ¢ÖÍ≤∞Ïû¨ÏûêÍ∞Ä Í≤∞Ïû¨ÌïòÎäîÍ≤ΩÏö∞ Îã§ÏùåÏÇ¨ÎûåÏù¥ Í≤∞Ïû¨ÏûêÏù∏Í≤ΩÏö∞ÏóêÎßå ÏïåÎ¶º Î≥¥ÎÇ¥Í∏∞ Ïö© -->
	<select id="getAtrzLineInfoByEmpNo" resultType="kr.or.ddit.sevenfs.vo.atrz.AtrzLineVO">
		  SELECT * 
		  FROM ATRZ_LINE 
		  WHERE ATRZ_DOC_NO = #{atrzDocNo}
		    AND SANCTNER_EMPNO = #{emplNo}
	</select>	
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨Î¨∏ÏÑú ÏàòÏ†ï -->
	<update id="atrzStatusFinalUpdate" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		UPDATE ATRZ /* AtrzMapper.atrzStatusFinalUpdate */
		SET 
			 ATRZ_STTUS_CODE = #{atrzSttusCode}
			,ATRZ_COMPT_DT = SYSDATE
		WHERE ATRZ_DOC_NO = #{atrzDocNo}
	</update>
	
	 <!-- Í≤∞Ïû¨ Î∞òÎ†§Ïãú -->
	<update id="atrzDetilCompUpdate" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		BEGIN
		UPDATE atrz_line  /* AtrzMapper.atrzDetailAppUpdate */
		SET 
			 SANCTN_PROGRS_STTUS_CODE = 20
			,SANCTN_CONFM_DT = SYSDATE
			,SANCTN_OPINION = #{atrzLineVOList[0].sanctnOpinion}
		WHERE ATRZ_DOC_NO = #{atrzDocNo} 
		AND SANCTNER_EMPNO = #{emplNo};
		
		UPDATE ATRZ
		 SET ATRZ_STTUS_CODE = 20
			,ATRZ_COMPT_DT = SYSDATE
			,ATRZ_OPINION = #{atrzLineVOList[0].sanctnOpinion}
		WHERE ATRZ_DOC_NO = #{atrzDocNo};
		END;
	</update>
	
	 <!-- Í∏∞ÏïàÏ∑®ÏÜåÏãú Ï†ÑÏûêÍ≤∞Ïû¨ÏÑ†   -->
	<update id="atrzLineCancelUpdate" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
		UPDATE ATRZ_LINE  	/* AtrzMapper.atrzLineCancelUpdate */
		SET 
		    sanctn_progrs_sttus_code = '30',
		    sanctn_confm_dt = SYSDATE
		WHERE atrz_doc_no = #{atrzDocNo}
		  AND EXISTS (
		      SELECT 1
		      FROM DUAL
		      WHERE EXISTS (
		          SELECT 1 FROM ATRZ
		          WHERE atrz_doc_no = #{atrzDocNo}
		            AND drafter_empno = #{emplNo}
		      )
		  )
	</update>
	
	<!-- Í∏∞ÏïàÏ∑®ÏÜåÏãú Ï†ÑÏûêÍ≤∞Ïû¨   -->
	<update id="atrzCancelUpdate" parameterType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO">
			UPDATE ATRZ			/* AtrzMapper.atrzCancelUpdate */
			SET 
			     atrz_sttus_code = '30'
			    ,atrz_rtrvl_dt = SYSDATE
			WHERE atrz_doc_no = #{atrzDocNo}
			  AND drafter_empno = #{emplNo}
	</update>
	
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú ÏµúÏ¢Ö Í≤∞Ïû¨ ÏôÑÎ£åÏãú -->
	<select id="selectHolidayByDocNo" resultMap="holidayDetailMap">
	    SELECT 				/* AtrzMapper.selectHolidayByDocNo */
	         H.HOLI_ACTPLN_NO
	        ,H.ATRZ_DOC_NO
	        ,H.HOLI_CODE
	        ,H.HOLI_START
	        ,H.HOLI_END
	        ,H.HOLI_USE_DAYS
	        /* AtrzVOÏóê ÌïÑÏöîÌïú Ïª¨ÎüºÎì§ (resultMapÏóêÏÑú Ï∞∏Ï°∞ÌïòÎäî Í≤ÉÎì§) */
	        ,A.ATCH_FILE_NO
	        ,A.ATRZ_CN
	        ,A.ATRZ_COMPT_DT
	        ,A.ATRZ_DELETE_YN
	        ,A.ATRZ_DRFT_DT
	        ,A.ATRZ_OPINION
	        ,A.ATRZ_RTRVL_DT
	        ,A.ATRZ_SJ
	        ,A.ATRZ_STTUS_CODE
	        ,A.ATRZ_TMPR_STRE_DT
	        ,A.BKMK_YN
	        ,A.DOC_FORM_NO
	        ,A.DRAFTER_CLSF
	        ,A.DRAFTER_DEPT
	        ,A.DRAFTER_EMPNM
	        ,A.DRAFTER_EMPNO
	        ,A.ELTSGN_IMAGE
	        ,A.SCHDUL_REG_YN
	    FROM DOCUM_HOLIDAY H
	    LEFT JOIN ATRZ A ON H.ATRZ_DOC_NO = A.ATRZ_DOC_NO
	    WHERE H.ATRZ_DOC_NO = #{atrzDocNo}
	</select>
	
	<!-- ÏßÄÏ∂úÍ≤∞ÏùòÏÑú ÏµúÏ¢Ö Í≤∞Ïû¨ ÏôÑÎ£åÏãú -->
	<select id="selectSpendingByDocNo" resultMap="spendingDetailMap">
	    SELECT 				/* AtrzMapper.selectSpendingByDocNo */
	          S.SPENDING_REPORT_NO
	        , S.ATRZ_DOC_NO
	        , S.EXPENSE_ORDER
	        , S.EXPENSE_DATE
	        , S.ITEM_DESCRIPTION
	        , S.ITEM_QUANTITY
	        , S.ITEM_AMOUNT
	        , S.PAYMENT_METHOD
	        /* AtrzVOÏóê ÌïÑÏöîÌïú Ïª¨ÎüºÎì§ (resultMapÏóêÏÑú Ï∞∏Ï°∞ÌïòÎäî Í≤ÉÎì§) */
	        ,A.ATCH_FILE_NO
	        ,A.ATRZ_CN
	        ,A.ATRZ_COMPT_DT
	        ,A.ATRZ_DELETE_YN
	        ,A.ATRZ_DRFT_DT
	        ,A.ATRZ_OPINION
	        ,A.ATRZ_RTRVL_DT
	        ,A.ATRZ_SJ
	        ,A.ATRZ_STTUS_CODE
	        ,A.ATRZ_TMPR_STRE_DT
	        ,A.BKMK_YN
	        ,A.DOC_FORM_NO
	        ,A.DRAFTER_CLSF
	        ,A.DRAFTER_DEPT
	        ,A.DRAFTER_EMPNM
	        ,A.DRAFTER_EMPNO
	        ,A.ELTSGN_IMAGE
	        ,A.SCHDUL_REG_YN
	    FROM DOCUM_SPENDING S
	    LEFT JOIN ATRZ A ON S.ATRZ_DOC_NO = A.ATRZ_DOC_NO
	    WHERE S.ATRZ_DOC_NO = #{atrzDocNo}
	</select>
	
	<!-- Í∏∞ÏïàÏÑú ÏµúÏ¢Ö Í≤∞Ïû¨ ÏôÑÎ£åÏãú -->
	<select id="selectDraftByDocNo" resultMap="draftDetailMap">
	    SELECT 				/* AtrzMapper.selectDraftByDocNo */
	          D.DRAFT_NO
	        , D.ATRZ_DOC_NO
	        /* AtrzVOÏóê ÌïÑÏöîÌïú Ïª¨ÎüºÎì§ (resultMapÏóêÏÑú Ï∞∏Ï°∞ÌïòÎäî Í≤ÉÎì§) */
	        ,A.ATCH_FILE_NO
	        ,A.ATRZ_CN
	        ,A.ATRZ_COMPT_DT
	        ,A.ATRZ_DELETE_YN
	        ,A.ATRZ_DRFT_DT
	        ,A.ATRZ_OPINION
	        ,A.ATRZ_RTRVL_DT
	        ,A.ATRZ_SJ
	        ,A.ATRZ_STTUS_CODE
	        ,A.ATRZ_TMPR_STRE_DT
	        ,A.BKMK_YN
	        ,A.DOC_FORM_NO
	        ,A.DRAFTER_CLSF
	        ,A.DRAFTER_DEPT
	        ,A.DRAFTER_EMPNM
	        ,A.DRAFTER_EMPNO
	        ,A.ELTSGN_IMAGE
	        ,A.SCHDUL_REG_YN
	    FROM DOCUM_DRAFT D
	    LEFT JOIN ATRZ A ON D.ATRZ_DOC_NO = A.ATRZ_DOC_NO
	    WHERE D.ATRZ_DOC_NO = #{atrzDocNo}
	</select>


	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú Í∏∞ÏïàÏôÑÎ£åÏãú Í∑ºÌÉúÌòÑÌô© Ïù∏ÏÑúÌä∏ -->
	<insert id="holidayDclzUpdate" parameterType="kr.or.ddit.sevenfs.vo.organization.DclzTypeVO">
		    INSERT INTO  /* AtrzMapper.holidayDclzUpdate */
		    DCLZ_TYPE 
		    (		
		         EMPL_NO
		        ,DCLZ_NO
		        ,DCLZ_CODE
		        ,DCLZ_BEGIN_DT
		        ,DCLZ_END_DT
		        ,DCLZ_REASON
		    ) VALUES (
		         #{emplNo}
		        ,#{dclzNo}
		        ,#{dclzCode}
		        ,#{dclzBeginDt}
		        ,#{dclzEndDt}
		        ,#{dclzReason}
		    )
	</insert>
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú Í∏∞ÏïàÏôÑÎ£åÏãú Ïó∞Ï∞®Í∞ØÏàò ÏÜåÏßÑÏãúÌÇ§Í∏∞ -->
	<update id="updateVacationUseDays" parameterType="kr.or.ddit.sevenfs.vo.organization.VacationVO">
	    UPDATE vacation   /* AtrzMapper.updateVacationUseDays */
		    SET 
		        yryc_use_daycnt =  #{yrycUseDaycnt}
		        ,yryc_remndr_daycnt =  #{yrycRemndrDaycnt}
		    WHERE empl_no = #{emplNo}
		    AND YRYC_YEAR = TO_CHAR(SYSDATE, 'YYYY')
	</update>
	<!-- Í∏∞ÏïàÏûêÏùò Ïó∞Ï∞®Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ -->
	<select id="emplVacationCnt" parameterType="string" resultType="kr.or.ddit.sevenfs.vo.organization.VacationVO">
		SELECT 				/* AtrzMapper.emplVacationCnt */
			    EMPL_NO
			, YRYC_YEAR
			, YRYC_USE_BEGIN_DATE
			, YRYC_USE_END_DATE
			, TOT_YRYC_DAYCNT
			, YRYC_USE_DAYCNT
			, YRYC_MDAT_DAYCNT
			, YRYC_REMNDR_DAYCNT
			, EXCESS_WORK_YRYC
			, CMPNSTN_YRYC
			, YRYC_CODE
			, YRYC_DETAIL
			FROM VACATION
			WHERE 1 = 1
			AND EMPL_NO = #{emplNo}
			AND YRYC_YEAR = TO_CHAR(SYSDATE, 'YYYY')
	</select>
	
	<!-- ÏûÑÏãúÏ†ÄÏû• Í≤∞Ïû¨ÏÑ† ÏÇ≠Ï†ú -->
	<delete id="deleteStorageAtrzLines">
		 DELETE FROM ATRZ_LINE WHERE ATRZ_DOC_NO IN
	    <foreach collection="atrzDocNos" item="atrzDocNo" open="(" separator="," close=")">
	        #{atrzDocNo}
	    </foreach>
	</delete>
	
	<!-- ÏûÑÏãúÏ†ÄÏû• Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú ÏÇ≠Ï†ú -->
	<delete id="deleteStorageDocumHoliday">
		 DELETE FROM DOCUM_HOLIDAY WHERE ATRZ_DOC_NO IN
	    <foreach collection="atrzDocNos" item="atrzDocNo" open="(" separator="," close=")">
	        #{atrzDocNo}
	    </foreach>
	</delete>
	
	<!-- ÏûÑÏãúÏ†ÄÏû• Í≤∞Ïû¨ÏÑ† ÏÇ≠Ï†ú -->
	<delete id="deleteStorageAtrz">
		 DELETE FROM ATRZ WHERE ATRZ_DOC_NO IN
	    <foreach collection="atrzDocNos" item="atrzDocNo" open="(" separator="," close=")">
	        #{atrzDocNo}
	    </foreach>
	</delete>
	
	<!-- ATRZ_LINE ÏÇ≠Ï†ú -->
	<delete id="deleteAtrzLineWriting" parameterType="string">
	    DELETE FROM ATRZ_LINE
	    WHERE ATRZ_DOC_NO = #{atrzDocNo}
	</delete>
	
	<!-- ATRZ ÏÇ≠Ï†ú -->
	<delete id="deleteAtrzWriting" parameterType="string">
	    DELETE FROM ATRZ
	    WHERE ATRZ_DOC_NO = #{atrzDocNo}
	</delete>
	
	
	
	<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú resultMap ÏÇ¨Ïö© -->
	<resultMap id="holidayDetailMap" type="kr.or.ddit.sevenfs.vo.atrz.HolidayVO" >
		<!-- Ïó∞Ï∞®Ïã†Ï≤≠ÏÑú -->
		<id property="holiActplnNo" column="HOLI_ACTPLN_NO"/>
		<result property="atrzDocNo" column="ATRZ_DOC_NO"/>
		<result property="holiCode" column="HOLI_CODE"/>
		<result property="holiStart" column="HOLI_START"/>
		<result property="holiEnd" column="HOLI_END"/>
		<result property="holiUseDays" column="HOLI_USE_DAYS"/>
		<result property="holiDelete" column="HOLI_DELETE"/>
		<association property="atrzVO" resultMap="atrzMap"></association>
	</resultMap>

	<!-- ÏßÄÏ∂úÍ≤∞ÏùòÏÑú resultMap -->
	<resultMap id="spendingDetailMap" type="kr.or.ddit.sevenfs.vo.atrz.SpendingVO" >
		<result property="spendingReportNo" column="SPENDING_REPORT_NO"/>
		<result property="atrzDocNo" column="ATRZ_DOC_NO"/>
		<result property="expenseOrder" column="EXPENSE_ORDER"/>
		<result property="expenseDate" column="EXPENSE_DATE"/>
		<result property="itemDescription" column="ITEM_DESCRIPTION"/>
		<result property="itemQuantity" column="ITEM_QUANTITY"/>
		<result property="itemAmount" column="ITEM_AMOUNT"/>
		<result property="paymentMethod" column="PAYMENT_METHOD"/>
		<result property="spendDelete" column="SPEND_DELETE"/>
		<association property="atrzVO" resultMap="atrzMap"></association>
	</resultMap>
	
	<!-- Í∏âÏó¨Î™ÖÏÑ∏ÏÑú resultMap -->
	<resultMap id="salaryDetailMap" type="kr.or.ddit.sevenfs.vo.atrz.SalaryVO">
		<result property="salaryNo" column="SALARY_NO"/>
		<result property="atrzDocNo" column="ATRZ_DOC_NO"/>
		<result property="baseSalary" column="BASE_SALARY"/>
		<result property="mealAllowance" column="MEAL_ALLOWANCE"/>
		<result property="incomeTax" column="INCOME_TAX"/>
		<result property="localTax" column="LOCAL_TAX"/>
		<result property="pension" column="PENSION"/>
		<result property="employmentIns" column="EMPLOYMENT_INS"/>
		<result property="healthIns" column="HEALTH_INS"/>
		<result property="careIns" column="CARE_INS"/>
		<result property="payDate" column="PAY_DATE"/>
		<result property="totalPay" column="TOTAL_PAY"/>
		<result property="totalDed" column="TOTAL_DED"/>
		<result property="netPay" column="NET_PAY"/>
		<result property="bonus" column="BONUS"/>
		<association property="atrzVO" resultMap="atrzMap"></association>
	</resultMap>
	
	<!-- Í∏âÏó¨Í≥ÑÏ¢åÎ≥ÄÍ≤ΩÏã†Ï≤≠ÏÑú resultMap -->
	<resultMap id="bankAccountDetailMap" type="kr.or.ddit.sevenfs.vo.atrz.BankAccountVO">
		<result property="bankAccNo" column="BANK_ACC_NO"/>
		<result property="atrzDocNo" column="ATRZ_DOC_NO"/>
		<result property="oldBank" column="OLD_BANK"/>
		<result property="oldAccNo" column="OLD_ACC_NO"/>
		<result property="newBank" column="NEW_BANK"/>
		<result property="newAccNo" column="NEW_ACC_NO"/>
		<result property="reason" column="REASON"/>
		<association property="atrzVO" resultMap="atrzMap"></association>
	</resultMap>
	
	<!-- Í∏∞ÏïàÏÑú resultMap -->
	<resultMap id="draftDetailMap" type="kr.or.ddit.sevenfs.vo.atrz.DraftVO" >
		<result property="draftNo" column="DRAFT_NO"/>
		<result property="atrzDocNo" column="ATRZ_DOC_NO"/>
		<association property="atrzVO" resultMap="atrzMap"></association>
	</resultMap>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ -->
	<resultMap type="kr.or.ddit.sevenfs.vo.atrz.AtrzVO" id="atrzMap">
		<result property="atchFileNo" column="ATCH_FILE_NO"/>
		<result property="atrzCn" column="ATRZ_CN"/>
		<result property="atrzComptDt" column="ATRZ_COMPT_DT"/>
		<result property="atrzDeleteYn" column="ATRZ_DELETE_YN"/>
		<result property="atrzDocNo" column="ATRZ_DOC_NO"/>
		<result property="atrzDrftDt" column="ATRZ_DRFT_DT"/>
		<result property="atrzOpinion" column="ATRZ_OPINION"/>
		<result property="atrzRtrvlDt" column="ATRZ_RTRVL_DT"/>
		<result property="atrzSj" column="ATRZ_SJ"/>
		<result property="atrzSttusCode" column="ATRZ_STTUS_CODE"/>
		<result property="atrzTmprStreDt" column="ATRZ_TMPR_STRE_DT"/>
		<result property="bkmkYn" column="BKMK_YN"/>
		<result property="docFormNo" column="DOC_FORM_NO"/>
		<result property="drafterClsf" column="DRAFTER_CLSF"/>
		<result property="drafterDept" column="DRAFTER_DEPT"/>
		<result property="drafterEmpnm" column="DRAFTER_EMPNM"/>
		<result property="drafterEmpno" column="DRAFTER_EMPNO"/>
		<result property="eltsgnImage" column="ELTSGN_IMAGE"/>
		<result property="schdulRegYn" column="SCHDUL_REG_YN"/>
		<result property="clsfCodeNm" column="CLSF_CODE_NM"/>
		<result property="deptCodeNm" column="DEPT_CODE_NM"/>
		<collection property="atrzLineVOList" resultMap="atrzLineMap"></collection>
	</resultMap>
	
	<!-- Ï†ÑÏûêÍ≤∞Ïû¨ÏÑ† -->
	<resultMap type="kr.or.ddit.sevenfs.vo.atrz.AtrzLineVO" id="atrzLineMap">
		<result property="atrzDocNo" column="ATRZ_DOC_NO"/>
		<result property="atrzLnSn" column="ATRZ_LN_SN"/>
		<result property="sanctnerEmpno" column="SANCTNER_EMPNO"/>
		<result property="sanctnerClsfCode" column="SANCTNER_CLSF_CODE"/>
		<result property="contdEmpno" column="CONTD_EMPNO"/>
		<result property="contdClsfCode" column="CONTD_CLSF_CODE"/>
		<result property="dcrbManEmpno" column="DCRB_MAN_EMPNO"/>
		<result property="dcrbManClsfCode" column="DCRB_MAN_CLSF_CODE"/>
		<result property="atrzTy" column="ATRZ_TY"/>
		<result property="sanctnProgrsSttusCode" column="SANCTN_PROGRS_STTUS_CODE"/>
		<result property="dcrbAuthorYn" column="DCRB_AUTHOR_YN"/>
		<result property="contdAuthorYn" column="CONTD_AUTHOR_YN"/>
		<result property="sanctnOpinion" column="SANCTN_OPINION"/>
		<result property="eltsgnImage" column="ELTSGN_IMAGE"/>
		<result property="sanctnConfmDt" column="SANCTN_CONFM_DT"/>
		<result property="sanctnerEmpNm" column="sanctner_empnm" />
		<result property="sanctnerDeptNm" column="sanctner_deptnm"/>
	</resultMap>
	
	<!-- ÏÇ¨Ïõê -->
	<resultMap id="EmployeeResultMap" type="kr.or.ddit.sevenfs.vo.organization.EmployeeVO">
       <id property="emplNo" column="EMPL_NO"/>
       <result property="emplNm" column="EMPL_NM"/>
       <result property="deptCode" column="DEPT_CODE"/>
       <result property="clsfCode" column="CLSF_CODE"/>
       <!-- Ï†ÑÏûêÍ≤∞Ïû¨ Î¶¨Ïä§Ìä∏ -->
       <collection property="EmplAtrzList" ofType="kr.or.ddit.sevenfs.vo.atrz.AtrzVO" resultMap="atrzMap"/>
    </resultMap>
	
	
</mapper>